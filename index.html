<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µí•© DA/í¼í¬ë¨¼ìŠ¤ ìº í˜ì¸ ì‹¬ì¸µ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .scroll-container::-webkit-scrollbar { height: 8px; width: 8px; }
        .scroll-container::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }
        .scroll-container::-webkit-scrollbar-track { background: #f1f5f9; }
        
        /* 4-Quadrant Matrix Styling */
        .quadrant-matrix {
            position: relative;
            width: 100%;
            height: 480px; 
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
        }
        .quadrant {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            position: relative;
            z-index: 10;
        }
        /* Quadrant Colors */
        .quadrant-top-right { background-color: rgba(16, 185, 129, 0.05); } /* Top-Right (STAR) */
        .quadrant-top-left { background-color: rgba(59, 130, 246, 0.05); } /* Top-Left (High Potential) */
        .quadrant-bottom-right { background-color: rgba(245, 158, 11, 0.05); } /* Bottom-Right (Niche) */
        .quadrant-bottom-left { background-color: rgba(239, 68, 68, 0.05); } /* Bottom-Left (Question Mark) */
        
        .quadrant-label { display: none; }
        
        /* Matrix Lines */
        .matrix-lines {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 20;
        }
        .v-line {
            position: absolute; left: 50%; top: 0; bottom: 0; width: 2px;
            border-left: 2px dashed #9ca3af; transform: translateX(-1px);
        }
        .h-line {
            position: absolute; top: 50%; left: 0; right: 0; height: 2px;
            border-top: 2px dashed #9ca3af; transform: translateY(-1px);
        }
        
        /* Chart Dots */
        .chart-dot {
            position: absolute; width: 14px; height: 14px; border-radius: 50%;
            cursor: pointer; z-index: 50; transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid #fff; box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
        }
        .chart-dot:hover { transform: scale(1.5); z-index: 60; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); }
        
        /* PM Dot */
        .chart-dot-perf {
            position: absolute; width: 14px; height: 14px; border-radius: 50%; /* Circle */
            cursor: pointer; z-index: 49; transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid #fff; 
            /* Ring effect for PM dots to distinguish from DA */
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.5), 0 0 8px rgba(0, 0, 0, 0.3); 
        }
        .chart-dot-perf:hover { transform: scale(1.5); z-index: 59; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); }

        /* Grouped Dot (Overlap) */
        .chart-dot-grouped {
            position: absolute; width: 16px; height: 16px; border-radius: 50%;
            cursor: pointer; z-index: 55; transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid #fff; 
            background: conic-gradient(from 90deg, #6366f1 0% 50%, #10b981 50% 100%); /* Indigo/Green Split */
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
        }
        .chart-dot-grouped:hover { transform: scale(1.5); z-index: 65; }
        
        .sortable { cursor: pointer; transition: background-color 0.2s; }
        .sortable:hover { background-color: #e5e7eb; }
        
        /* Table Headers */
        #validation-input-table thead th, #sample-input-table thead th {
            text-align: center; vertical-align: middle; border-bottom: 1px solid #e5e7eb; z-index: 10;
        }
        #validation-input-table thead tr:first-child th, #sample-input-table thead tr:first-child th {
            border-bottom: none; border-right: 1px solid #d1d5db; top: 0;
        }
        #validation-input-table thead tr:last-child th, #sample-input-table thead tr:last-child th {
             border-right: 1px solid #e5e7eb; padding-top: 4px; top: 33px; /* Approx height */
        }
        
        .header-subtext {
            display: block; font-size: 0.65rem; font-weight: 500; color: #4b5563; margin-top: 1px;
        }
        
        .input-prefill { color: #9ca3af; }
        .input-prefill:focus { color: #111827; }
        
        /* Custom Modal Size */
        #sample-modal-content {
            max-width: 95vw;
            width: 1600px;
            max-height: 90vh;
        }
        
        #custom-score-modal-backdrop { background-color: rgba(0, 0, 0, 0.5); }
        #custom-score-modal-content { max-width: 90vw; width: 900px; max-height: 80vh; }
        .tab-button.active { border-color: #4f46e5; color: #4f46e5; background-color: #eef2ff; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div id="app" class="w-full mx-auto bg-white rounded-xl shadow-2xl p-8 md:p-12">
        <!-- Header -->
        <header class="mb-8 border-b pb-4">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2">í†µí•© ìº í˜ì¸ ì„±ê³¼ ì‹¬ì¸µ ë¶„ì„ ëŒ€ì‹œë³´ë“œ (PC)</h1>
            <p class="text-gray-500">DA/í¼í¬ë¨¼ìŠ¤ ëª©í‘œë³„ íš¨ìœ¨ ë¶„ì„ ë° ì†Œì¬ ë“±ê¸‰ë³„ ì§ê´€ì  ì¸ì‚¬ì´íŠ¸ ë„ì¶œ</p>
        </header>

        <!-- Project Selector -->
        <div class="mb-8 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <label for="project-selector" class="text-lg font-bold text-gray-800">í”„ë¡œì íŠ¸:</label>
                <select id="project-selector" class="rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 min-w-[200px]">
                    <!-- Options loaded by JS -->
                </select>
                <button id="edit-project-button" class="text-gray-500 hover:text-indigo-600 transition-colors p-1" title="í”„ë¡œì íŠ¸ ì´ë¦„ ìˆ˜ì •">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                    </svg>
                </button>
                <button id="delete-project-button" class="text-gray-500 hover:text-red-600 transition-colors p-1" title="í”„ë¡œì íŠ¸ ì‚­ì œ">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </button>
            </div>
            <div class="flex space-x-2">
                <button id="new-project-button" class="bg-green-500 text-white hover:bg-green-600 text-sm font-semibold py-2 px-4 rounded-lg transition-colors flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-1"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg>
                    ìƒˆ í”„ë¡œì íŠ¸
                </button>
            </div>
        </div>
        
        <!-- Campaign Validation Input Section -->
        <div id="validation-section" class="mb-10">
            <div class="flex items-center justify-between mb-4 border-b pb-2">
                <div class="flex items-center">
                    <h2 class="text-2xl font-bold text-gray-800 mr-4">
                        ìº í˜ì¸ ëª©í‘œ & ì„±ê³¼ ê²€ì¦ í•­ëª© ì…ë ¥
                    </h2>
                    <button id="view-sample-button" class="bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 text-xs font-bold py-1.5 px-3 rounded-md transition-colors flex items-center shadow-sm">
                         ìƒ˜í”Œ ë³´ê¸°
                    </button>
                </div>
                
                <button id="toggle-validation-table" class="bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-sm font-semibold py-2 px-4 rounded-lg transition-colors flex items-center">
                    <span id="toggle-text">ì…ë ¥ í…Œì´ë¸” ì ‘ê¸°</span> 
                    <svg id="toggle-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 ml-1 transform transition-transform rotate-180"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.25 4.25a.75.75 0 01-1.06 0L5.23 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd" /></svg>
                </button>
            </div>
            
            <div id="validation-table-content" class="transition-all duration-300 overflow-hidden">
                <div class="bg-gray-50 p-4 rounded-xl shadow-inner border">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-sm text-gray-600">
                            <span id="validation-campaign-label" class="font-bold text-indigo-600">í†µí•© ìº í˜ì¸</span> íš¨ìœ¨ ê²€ì¦ í•­ëª©ì„ ì§ì ‘ ê¸°ì¬í•´ì£¼ì„¸ìš”.
                        </p>
                        <div class="flex items-center space-x-2">
                            <span id="save-status" class="text-sm text-green-600 font-medium hidden">ì €ì¥ë¨!</span>
                            <button id="save-data-button" class="bg-blue-500 text-white hover:bg-blue-600 text-xs font-semibold py-1 px-3 rounded-md transition-colors">
                                 ğŸ’¾  í˜„ì¬ ë‚´ìš© ì €ì¥
                            </button>
                            <button id="reset-data-button" class="bg-red-500 text-white hover:bg-red-600 text-xs font-semibold py-1 px-3 rounded-md transition-colors">
                                 ğŸ”„  ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
                            </button>
                            <button id="add-validation-row" class="bg-green-500 text-white hover:bg-green-600 text-xs font-semibold py-1 px-3 rounded-md transition-colors">
                                + í•­ëª© ì¶”ê°€
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto max-h-[600px] scroll-container border rounded-lg">
                        <table id="validation-input-table" class="min-w-full divide-y divide-gray-200 border-separate border-spacing-0 relative">
                            <thead id="validation-table-header" class="bg-gray-100 z-20"></thead>
                            <tbody id="validation-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mb-10 text-center">
            <button id="run-analysis-button" class="bg-blue-600 text-white hover:bg-blue-700 text-xl font-bold py-3 px-8 rounded-xl shadow-xl transition-all transform hover:scale-[1.02] active:scale-[0.98]">
                  ğŸ“Š   ì…ë ¥ ë°ì´í„° ê¸°ë°˜ ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ì¬ì‹¤í–‰
            </button>
        </div>
        
        <div id="analysis-results"> 
            <div class="mb-10">
                <h2 id="summary-main-title" class="text-2xl font-bold text-gray-800 mb-4">
                    ì¢…í•© ì„±ê³¼ ìš”ì•½ 
                    <span id="summary-title" class="text-indigo-600 text-lg ml-2"></span>
                </h2>
                <div class="scroll-container overflow-x-auto rounded-xl shadow-lg border">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-indigo-50">
                            <tr id="summary-header" class="text-sm font-semibold text-indigo-700 uppercase tracking-wider"></tr>
                        </thead>
                        <tbody id="summary-body" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
            
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-10">
                <!-- Matrix -->
                <div class="xl:col-span-2 space-y-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                            ì†Œì¬ ì„±ê³¼ ë§¤íŠ¸ë¦¬ìŠ¤
                        </h2>
                        <div class="quadrant-matrix" id="quadrant-matrix">
                            <div class="matrix-lines"><div class="v-line"></div><div class="h-line"></div></div>
                            <div class="quadrant quadrant-top-left"><div class="relative z-10 flex flex-col justify-center text-center"><h3 class="text-xl font-extrabold text-blue-700">High Potential</h3><p class="text-sm text-gray-500 mt-2">ë…¸ì¶œ íš¨ìœ¨(Low) ì†Œì¬ ë§¤ë ¥ë„(High)</p><p class="text-sm text-gray-700 mt-2">í›…í‚¹ì„±ì€ ë†’ì§€ë§Œ ì˜ ì•Œë ¤ì§€ì§€ ì•Šì€ ì†Œì¬</p><div class="mt-4"><span class="inline-block py-1 px-3 rounded-full text-sm font-semibold text-blue-800 bg-blue-100">Action : íƒ€ê²ŸíŒ… í™•ì¥</span></div></div></div>
                            <div class="quadrant quadrant-top-right"><div class="relative z-10 flex flex-col justify-center text-center"><h3 class="text-xl font-extrabold text-green-700">STAR</h3><p class="text-sm text-gray-500 mt-2">ë…¸ì¶œ íš¨ìœ¨(High) ì†Œì¬ ë§¤ë ¥ë„(High)</p><p class="text-sm text-gray-700 mt-2">ëŒ€ì¤‘ì ìœ¼ë¡œ ê°€ì¥ ë°˜ì‘ì´ ìš°ìˆ˜í•œ ì†Œì¬</p><div class="mt-4"><span class="inline-block py-1 px-3 rounded-full text-sm font-semibold text-green-800 bg-green-100">Action : ìœ ì§€ / ì˜ˆì‚° ì¦ëŒ€</span></div></div></div>
                            <div class="quadrant quadrant-bottom-left"><div class="relative z-10 flex flex-col justify-center text-center"><h3 class="text-xl font-extrabold text-red-700">Question Mark</h3><p class="text-sm text-gray-500 mt-2">ë…¸ì¶œ íš¨ìœ¨(Low) ì†Œì¬ ë§¤ë ¥ë„(Low)</p><p class="text-sm text-gray-700 mt-2">ì˜ˆì‚° ë‚­ë¹„ ê°€ëŠ¥ì„±ì´ ë†’ì€ ì†Œì¬</p><div class="mt-4"><span class="inline-block py-1 px-3 rounded-full text-sm font-semibold text-red-800 bg-red-100">Action : ê´‘ê³ OFF / ì˜ˆì‚°ì´ê´€</span></div></div></div>
                            <div class="quadrant quadrant-bottom-right"><div class="relative z-10 flex flex-col justify-center text-center"><h3 class="text-xl font-extrabold text-amber-700">Niche</h3><p class="text-sm text-gray-500 mt-2">ë…¸ì¶œ íš¨ìœ¨(High) ì†Œì¬ ë§¤ë ¥ë„(Low)</p><p class="text-sm text-gray-700 mt-2">ì†Œìˆ˜ì˜ ì§‘ë‹¨ì—ì„œ ë°˜ì‘ì´ ë†’ì€ ì†Œì¬</p><div class="mt-4"><span class="inline-block py-1 px-3 rounded-full text-sm font-semibold text-amber-800 bg-amber-100">Action : ë²”ìš©ì  ì†Œì¬ / í›…í‚¹ì„± ê°•í™”</span></div></div></div>
                        </div>
                    </div>
                </div>
                <!-- Insight -->
                <div class="xl:col-span-1 space-y-6">
                    <div class="bg-indigo-50 p-6 rounded-xl shadow-lg border border-indigo-200 h-full">
                        <h2 class="text-2xl font-bold text-indigo-700 mb-4 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                            MEDIA INSIGHT
                        </h2>
                        <ul id="insight-list" class="space-y-4 text-gray-700 text-sm"></ul>
                    </div>
                </div>
            </div>
            
            <!-- Efficiency Table -->
            <div class="mt-10">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">ìº í˜ì¸ ìƒì„¸ íš¨ìœ¨ ì§€í‘œ (ì†Œì¬ë³„)</h2>
                <div class="scroll-container overflow-x-auto rounded-xl shadow-inner border max-h-[600px]">
                    <table class="min-w-full divide-y divide-gray-200 relative border-separate border-spacing-0">
                        <thead class="bg-gray-100 sticky top-0 z-20">
                            <tr id="table-header" class="text-xs font-medium text-gray-500 uppercase tracking-wider"></tr>
                        </thead>
                        <tbody id="table-body" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sample Modal -->
    <div id="sample-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
        <div id="sample-modal-content" class="bg-white rounded-2xl shadow-2xl w-full flex flex-col overflow-hidden">
            <div class="p-6 border-b flex justify-between items-center bg-indigo-50">
                <h3 class="text-2xl font-bold text-gray-800">ìƒ˜í”Œ ëŒ€ì‹œë³´ë“œ</h3>
                <button id="close-sample-modal" class="text-gray-500 hover:text-gray-700 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="sample-modal-body" class="p-8 overflow-y-auto bg-slate-50 space-y-10">
                <!-- (1) Input -->
                <div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">[ìƒ˜í”Œ] ìº í˜ì¸ ëª©í‘œ & ì„±ê³¼ ê²€ì¦ í•­ëª© ì…ë ¥</h2>
                    <div class="overflow-x-auto rounded-xl border shadow-sm bg-white max-h-[400px] scroll-container">
                        <table id="sample-input-table" class="min-w-full divide-y divide-gray-200 border-separate border-spacing-0 relative"></table>
                    </div>
                </div>
                <!-- (2) Summary -->
                <div id="sample-summary-section"></div>
                <!-- (3) Chart -->
                <div id="sample-chart-section"></div>
                <!-- (4) Insight -->
                 <div id="sample-insight-section" class="bg-indigo-50 p-6 rounded-xl shadow-lg border border-indigo-200">
                    <h2 class="text-xl font-bold text-indigo-700 mb-4">MEDIA INSIGHT (ìƒ˜í”Œ)</h2>
                    <ul id="sample-insight-list" class="space-y-4 text-gray-700 text-sm"></ul>
                </div>
                <!-- (5) Detail Table -->
                <div>
                    <h2 class="text-xl font-bold text-gray-800 mb-4">ìº í˜ì¸ ìƒì„¸ íš¨ìœ¨ ì§€í‘œ (ìƒ˜í”Œ)</h2>
                    <div class="scroll-container overflow-x-auto rounded-xl shadow-inner border bg-white max-h-[400px]">
                        <table class="min-w-full divide-y divide-gray-200 relative border-separate border-spacing-0">
                            <thead class="bg-gray-100 sticky top-0 z-20">
                                <tr id="sample-table-header" class="text-xs font-medium text-gray-500 uppercase tracking-wider"></tr>
                            </thead>
                            <tbody id="sample-table-body" class="bg-white divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t bg-gray-50 flex justify-end">
                <button id="close-sample-modal-btn" class="bg-gray-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-gray-900 transition-colors">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì»¤ìŠ¤í…€ ì„¤ì • ëª¨ë‹¬ (6ë‹¨ê³„ - ì¤€ë¹„ë§Œ ë¨, ê¸°ëŠ¥ ì—†ìŒ) -->
    <div id="custom-score-modal-backdrop" class="fixed inset-0 z-[110] hidden flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
        <div id="custom-score-modal-content" class="bg-white rounded-2xl shadow-2xl w-full flex flex-col overflow-hidden max-w-4xl max-h-[80vh]">
             <div class="p-6 border-b flex justify-between items-center bg-gray-50">
                <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" /></svg>
                    ë‚˜ë§Œì˜ ì„±ê³¼ ê¸°ì¤€ ì„¤ì •
                </h3>
                <button id="close-custom-score-modal" class="text-gray-500 hover:text-gray-700 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div class="p-6 flex-1 overflow-y-auto bg-white" id="custom-score-modal-body">
                <!-- Tabs -->
                <div class="flex space-x-4 mb-6 border-b">
                    <button class="tab-button px-4 py-2 font-semibold text-gray-600 border-b-2 border-transparent hover:text-indigo-600 active" data-tab="da">DA ì„±ê³¼ ê¸°ì¤€</button>
                    <button class="tab-button px-4 py-2 font-semibold text-gray-600 border-b-2 border-transparent hover:text-indigo-600" data-tab="perf">í¼í¬ë¨¼ìŠ¤ ì„±ê³¼ ê¸°ì¤€</button>
                    <button class="tab-button px-4 py-2 font-semibold text-gray-600 border-b-2 border-transparent hover:text-indigo-600" data-tab="insight">ì¸ì‚¬ì´íŠ¸ ë¬¸êµ¬ ì„¤ì •</button>
                </div>
                
                <!-- Content (Placeholder) -->
                <div class="p-8 text-center text-gray-500">
                    ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. (6ë‹¨ê³„)
                </div>
            </div>
             <div class="p-4 border-t bg-gray-50 flex justify-end space-x-3 items-center">
                <span id="custom-score-save-status" class="text-green-600 font-medium text-sm hidden flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</span>
                <button id="reset-custom-score-btn" class="text-gray-600 hover:text-red-600 text-sm font-semibold px-4 py-2 transition-colors">ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”</button>
                <button id="save-custom-score-btn" class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 transition-colors shadow-md">ì„¤ì • ì €ì¥</button>
            </div>
        </div>
    </div>
    
    <script>
        const DASHBOARD_STORAGE_KEY = 'campaignDashboardStorage';
        
        let isPerfInputVisible = false; 
        let isScoreVisible = false;
        let currentProject = 'default';
        let isPrefillActive = true; 
        
        // [MODIFY] Updated Default Score Settings (Strict Criteria)
        const defaultScoreSettings = {
            cpm: { 5: 0.7, 4: 0.9, 3: 1.05, 2: 1.25 },
            ctr: { 5: 1.5, 4: 1.15, 3: 0.95, 2: 0.75 },
            cpc: { 5: 0.7, 4: 0.9, 3: 1.05, 2: 1.25 },
            cvr: { 5: 1.5, 4: 1.15, 3: 0.95, 2: 0.75 },
            cpa: { 5: 0.7, 4: 0.9, 3: 1.05, 2: 1.25 },
            roas: { 5: 600, 4: 400, 3: 250, 2: 150 }
        };
        
        function saveDataToLocalStorage() {
            try {
                localStorage.setItem(DASHBOARD_STORAGE_KEY, JSON.stringify(storageData));
                const saveStatus = document.getElementById('save-status');
                saveStatus.classList.remove('hidden');
                setTimeout(() => { saveStatus.classList.add('hidden'); }, 2000);
            } catch (e) { console.error("Error saving", e); }
        }
        
        const formatNumericInput = (value) => {
            const cleanValue = value.toString().replace(/[^\d]/g, ''); 
            return cleanValue === '' ? '' : parseInt(cleanValue, 10).toLocaleString('ko-KR');
        };
        const formatNumber = (num, type) => {
            if (typeof num !== 'number' || isNaN(num) || num === null) return '-';
            switch (type) {
                case 'percent': return `${(num * 100).toFixed(2)}%`;
                case 'currency': return `${Math.round(num).toLocaleString('ko-KR')}ì›`;
                case 'score': return num.toFixed(2);
                default: return num.toLocaleString('ko-KR');
            }
        };

        const campaignData = {
            'MAIN': {
                name: 'í†µí•© ìº í˜ì¸',
                headers: [
                    { name: 'ë§¤ì²´', key: 'media' }, { name: 'ìƒí’ˆ', key: 'placement' }, { name: 'ì†Œì¬ëª…', key: 'creativeName' },
                    { name: 'ê´‘ê³ ë¹„(ì›)', key: 'cost' }, { name: 'ë…¸ì¶œìˆ˜', key: 'imp' }, { name: 'í´ë¦­ìˆ˜', key: 'click' }, { name: 'ì „í™˜ìˆ˜', key: 'conv' },
                    { name: 'CPM(ì›)', key: 'actualCpm' }, { name: 'CTR(%)', key: 'actualCtr' }, { name: 'CPC(ì›)', key: 'actualCpc' }, 
                    { name: 'CVR(%)', key: 'actualCvr' }, { name: 'CPA(ì›)', key: 'actualCpa' },
                    { name: 'DA ì¸ì‚¬ì´íŠ¸', key: 'daInsight' }, { name: 'DA í”¼ë“œë°±', key: 'daAction' },
                    { name: 'PM ì¸ì‚¬ì´íŠ¸', key: 'pmInsight' }, { name: 'PM í”¼ë“œë°±', key: 'pmAction' },
                    { name: 'A ì ìˆ˜', key: 'scoreA' }, { name: 'B ì ìˆ˜', key: 'scoreB' }, { name: 'C ì ìˆ˜', key: 'scoreC' },
                    { name: 'ë§¤ì¶œì•¡(ì›)', key: 'revenue' }, { name: 'ROAS(%)', key: 'roas' }
                ],
                data: [
                    { media: 'ë„¤ì´ë²„', creative: 'ì†Œì¬A_ìŠ¤í˜ì…œDA', cost: 11480000, imp: 7200000, click: 16000, cpm: null, ctr: null, cpc: null, scoreA: null, scoreB: null, total: null, insight: null, color: null, mediaInsight: null },
                    { media: 'ì¹´ì¹´ì˜¤', creative: 'ì†Œì¬B_ë¹„ì¦ˆë³´ë“œ', cost: 150000000, imp: 170000000, click: 250000, cpm: null, ctr: null, cpc: null, scoreA: null, scoreB: null, total: null, insight: null, color: null, mediaInsight: null },
                    { media: 'êµ¬ê¸€', creative: 'ì†Œì¬C_GDN', cost: 80000000, imp: 9500000, click: 25000, cpm: null, ctr: null, cpc: null, scoreA: null, scoreB: null, total: null, insight: null, color: null, mediaInsight: null },
                ],
            },
        };

        // [MODIFY] 9 Sample Data (3 Top, 3 Mid, 3 Low) with Balanced Quadrants (Revised with new Strict Scoring)
        // Target Criteria: CPM<70%(5), <90%(4), <105%(3), <125%(2)
        // CTR>150%(5), >115%(4), >95%(3), >75%(2)
        const testProjectMockData = [
            // --- Top 3 ---
            // 1. STAR (DA High): Naver/SpecialDA/Material A
            // A(CPM): 2000/3000 = 0.66 (<0.7) -> 5
            // B(CTR): 0.004/0.002 = 2.0 (>1.5) -> 5
            { media: 'ë„¤ì´ë²„', placement: 'ìŠ¤í˜ì…œDA', creativeName: 'ì†Œì¬ A', cost: 10000000, imp: 5000000, click: 20000, conv: null, revenue: null, targetCpm: 3000, targetCpc: 600, targetCtr: 0.002, targetCvr: null, targetCpa: null },
            
            // 2. STAR (PM High): Google/UAC/Material B
            // C(CPA): 10000/15000 = 0.66 (<0.7) -> 5
            // B(CTR): 0.02/0.01 = 2.0 (>1.5) -> 5
            { media: 'êµ¬ê¸€', placement: 'UAC', creativeName: 'ì†Œì¬ B', cost: 20000000, imp: 2000000, click: 40000, conv: 2000, revenue: 100000000, targetCpm: 12000, targetCpc: 600, targetCtr: 0.01, targetCvr: 0.03, targetCpa: 15000 },
            
            // 3. STAR (DA High): Kakao/BizBoard/Material C
            // A(CPM): 2000/2500 = 0.8 (<0.9) -> 4
            // B(CTR): 0.0025/0.002 = 1.25 (>1.15) -> 4
            { media: 'ì¹´ì¹´ì˜¤', placement: 'ë¹„ì¦ˆë³´ë“œ', creativeName: 'ì†Œì¬ C', cost: 8000000, imp: 4000000, click: 10000, conv: null, revenue: null, targetCpm: 2500, targetCpc: 1000, targetCtr: 0.002, targetCvr: null, targetCpa: null },

            // --- Mid 3 ---
            // 4. High Potential (DA): A Low(2), B High(4)
            // A(CPM): 1250/1000 = 1.25 (<=1.25) -> 2
            // B(CTR): 0.004/0.003 = 1.33 (>1.15) -> 4
            { media: 'ë²„ì¦ˆë¹Œ', placement: 'ë„¤íŠ¸ì›Œí¬', creativeName: 'ì†Œì¬ D', cost: 5000000, imp: 4000000, click: 16000, conv: null, revenue: null, targetCpm: 1000, targetCpc: 500, targetCtr: 0.003, targetCvr: null, targetCpa: null },

            // 5. Niche (DA): A High(5), B Low(2)
            // A(CPM): 5000/8000 = 0.62 (<0.7) -> 5
            // B(CTR): 0.005/0.006 = 0.83 (>0.75) -> 2
            { media: 'ë„¤ì´ë²„', placement: 'íƒ€ì„ë³´ë“œ', creativeName: 'ì†Œì¬ E', cost: 20000000, imp: 4000000, click: 20000, conv: null, revenue: null, targetCpm: 8000, targetCpc: 2000, targetCtr: 0.006, targetCvr: null, targetCpa: null },

            // 6. Mid (PM): C Mid(3), B Mid(3)
            // C(CPA): 20000/20000 = 1.0 (<=1.05) -> 3
            // B(CTR): 0.01/0.01 = 1.0 (>=0.95) -> 3
            { media: 'META', placement: 'PPA', creativeName: 'ì†Œì¬ F', cost: 3000000, imp: 3000000, click: 30000, conv: 150, revenue: 9000000, targetCpm: 2000, targetCpc: 2000, targetCtr: 0.01, targetCvr: 0.005, targetCpa: 20000 },

            // --- Low 3 ---
            // 7. Question Mark (DA Low): A Low(1), B Low(2)
            // A(CPM): 4000/3000 = 1.33 (>1.25) -> 1
            // B(CTR): 0.001/0.0012 = 0.83 (>0.75) -> 2
            { media: 'ì—ë¸Œë¦¬íƒ€ì„', placement: 'í™ˆë°°ë„ˆ', creativeName: 'ì†Œì¬ G', cost: 2000000, imp: 500000, click: 500, conv: null, revenue: null, targetCpm: 3000, targetCpc: 3000, targetCtr: 0.0012, targetCvr: null, targetCpa: null },

            // 8. Question Mark (DA Low): A Low(2), B Low(1)
            // A(CPM): 5000/4200 = 1.19 (<=1.25) -> 2
            // B(CTR): 0.001/0.002 = 0.5 (<0.75) -> 1
            { media: 'êµ¬ê¸€', placement: 'GDN', creativeName: 'ì†Œì¬ H', cost: 5000000, imp: 1000000, click: 1000, conv: null, revenue: null, targetCpm: 4200, targetCpc: 4000, targetCtr: 0.002, targetCvr: null, targetCpa: null },

            // 9. Low (PM Low): C Low(1), B Low(2)
            // C(CPA): 500000/350000 = 1.42 (>1.25) -> 1
            // B(CTR): 0.004/0.005 = 0.8 (>0.75) -> 2
            { media: 'ì¹´ì¹´ì˜¤', placement: 'ë©”ì‹œì§€', creativeName: 'ì†Œì¬ I', cost: 1000000, imp: 100000, click: 400, conv: 2, revenue: null, targetCpm: 5000, targetCpc: 4000, targetCtr: 0.005, targetCvr: 0.005, targetCpa: 350000 },
        ];

        let sortColumn = 'cost';
        let sortDirection = 'desc';
        let liveAnalysisData = null; 
        
        const validationTableConfigs = {
            'MAIN': {
                label: 'í†µí•© ìº í˜ì¸',
                headerGroups: [
                    { name: 'ê¸°ë³¸ ì •ë³´', cols: ['media', 'placement', 'creativeName', 'cost', 'imp'] },
                    { name: 'ë…¸ì¶œ ì„±ê³¼ (CPM)', cols: ['targetCpm', 'actualCpm'] },
                    { name: 'í´ë¦­ ì„±ê³¼ (CPC/CTR)', cols: ['click', 'targetCpc', 'actualCpc', 'targetCtr', 'actualCtr'] },
                    { name: 'ì „í™˜ ì„±ê³¼ (CPA)', cols: ['conv', 'targetCvr', 'actualCvr', 'targetCpa', 'actualCpa', 'revenue'] },
                ],
                cols: [
                    { name: 'ë§¤ì²´', key: 'media', type: 'text', placeholder: 'ë§¤ì²´', width: 'w-24', group: 'ê¸°ë³¸ ì •ë³´' },
                    { name: 'ìƒí’ˆ', key: 'placement', type: 'text', placeholder: 'ìƒí’ˆ', width: 'w-24', group: 'ê¸°ë³¸ ì •ë³´' },
                    { name: 'ì†Œì¬ëª…', key: 'creativeName', type: 'text', placeholder: 'ì†Œì¬ëª…', width: 'w-24', group: 'ê¸°ë³¸ ì •ë³´' },
                    { name: 'ê´‘ê³ ë¹„(ì›)', key: 'cost', type: 'number', placeholder: 'ê¸ˆì•¡', width: 'w-24', isLargeNumber: true, group: 'ê¸°ë³¸ ì •ë³´' },
                    { name: 'ë…¸ì¶œìˆ˜', key: 'imp', type: 'number', placeholder: 'íšŸìˆ˜', width: 'w-20', isLargeNumber: true, group: 'ê¸°ë³¸ ì •ë³´' }, 
                    
                    { name: 'ëª©í‘œ CPM(ì›)', key: 'targetCpm', type: 'currency', placeholder: 'ëª©í‘œCPM', width: 'w-24', isLargeNumber: true, group: 'ë…¸ì¶œ ì„±ê³¼ (CPM)' },
                    { name: 'CPM(ì›)', key: 'actualCpm', type: 'currency', placeholder: 'ì„±ê³¼CPM', width: 'w-24', calculated: true, group: 'ë…¸ì¶œ ì„±ê³¼ (CPM)' }, 
                    
                    { name: 'í´ë¦­ìˆ˜', key: 'click', type: 'number', placeholder: 'íšŸìˆ˜', width: 'w-20', isLargeNumber: true, group: 'í´ë¦­ ì„±ê³¼ (CPC/CTR)' }, 
                    { name: 'ëª©í‘œ CPC(ì›)', key: 'targetCpc', type: 'currency', placeholder: 'ëª©í‘œCPC', width: 'w-24', isLargeNumber: true, group: 'í´ë¦­ ì„±ê³¼ (CPC/CTR)' },
                    { name: 'CPC(ì›)', key: 'actualCpc', type: 'currency', placeholder: 'ì„±ê³¼CPC', width: 'w-24', calculated: true, group: 'í´ë¦­ ì„±ê³¼ (CPC/CTR)' },
                    { name: 'ëª©í‘œ CTR(%)', key: 'targetCtr', type: 'percent', placeholder: 'ëª©í‘œCTR', width: 'w-24', group: 'í´ë¦­ ì„±ê³¼ (CPC/CTR)' },
                    { name: 'CTR(%)', key: 'actualCtr', type: 'percent', placeholder: 'ì„±ê³¼CTR', width: 'w-24', calculated: true, group: 'í´ë¦­ ì„±ê³¼ (CPC/CTR)' },
                    
                    { name: 'ì „í™˜ìˆ˜', key: 'conv', type: 'number', placeholder: 'íšŸìˆ˜', width: 'w-20', isLargeNumber: true, group: 'ì „í™˜ ì„±ê³¼ (CPA)' }, 
                    { name: 'ëª©í‘œ ì „í™˜ìœ¨(%)', key: 'targetCvr', type: 'percent', placeholder: 'ëª©í‘œCVR', width: 'w-24', group: 'ì „í™˜ ì„±ê³¼ (CPA)' },
                    { name: 'CVR(%)', key: 'actualCvr', type: 'percent', placeholder: 'ì„±ê³¼CVR', width: 'w-24', calculated: true, group: 'ì „í™˜ ì„±ê³¼ (CPA)' },
                    { name: 'ëª©í‘œ CPA(ì›)', key: 'targetCpa', type: 'currency', placeholder: 'ëª©í‘œCPA', width: 'w-24', isLargeNumber: true, group: 'ì „í™˜ ì„±ê³¼ (CPA)' },
                    { name: 'CPA(ì›)', key: 'actualCpa', type: 'currency', placeholder: 'ì„±ê³¼CPA', width: 'w-24', calculated: true, group: 'ì „í™˜ ì„±ê³¼ (CPA)' },
                    { name: 'ë§¤ì¶œì•¡(ì›)', key: 'revenue', type: 'currency', placeholder: 'ê¸ˆì•¡(ì˜µì…˜)', width: 'w-24', isLargeNumber: true, group: 'ì „í™˜ ì„±ê³¼ (CPA)' },
                ],
            },
        };
        
        const mapCampaignDataToValidation = (sourceData) => {
            const dataToMap = sourceData; 
            const configCols = validationTableConfigs['MAIN'].cols;
            
            return dataToMap.map((sourceItem) => {
                const row = { id: crypto.randomUUID() };
                row.isPrefill = !!sourceItem.media; 
                
                configCols.forEach(col => {
                    row[col.key] = sourceItem[col.key] ?? null; // [FIX] undefined handling
                });

                row.media = sourceItem.media || null;
                const parts = sourceItem.creative ? String(sourceItem.creative).split('_') : [null, null];
                row.creativeName = sourceItem.creativeName || parts[0] || null; 
                row.placement = sourceItem.placement || parts[1] || null; 
                
                if (row.isPrefill) {
                     if (sourceItem.media === 'ë„¤ì´ë²„') {
                        row.targetCpm = sourceItem.targetCpm || 2000;
                        row.targetCpc = sourceItem.targetCpc || 740;
                        row.targetCtr = sourceItem.targetCtr || 0.0020;
                    } else if (sourceItem.media === 'ì¹´ì¹´ì˜¤') {
                        row.targetCpm = sourceItem.targetCpm || 900;
                        row.targetCpc = sourceItem.targetCpc || 400;
                        row.targetCtr = sourceItem.targetCtr || 0.0025;
                    } else if (sourceItem.media === 'êµ¬ê¸€') {
                        row.targetCpm = sourceItem.targetCpm || 5000;
                        row.targetCpc = sourceItem.targetCpc || 2000;
                        row.targetCtr = sourceItem.targetCtr || 0.0040;
                    }
                }
                return row;
            });
        };
        
        let isValidationTableOpen = true; 
        const defaultValidationData = { 'MAIN': mapCampaignDataToValidation(campaignData.MAIN.data) };
        let storageData = { currentProject: 'default', projects: { 'default': defaultValidationData } };
        let validationData = storageData.projects[currentProject];
        
        const runAnalysisButton = document.getElementById('run-analysis-button');
        const analysisResults = document.getElementById('analysis-results'); 
        const validationTableContent = document.getElementById('validation-table-content');
        const toggleValidationTableButton = document.getElementById('toggle-validation-table');
        const validationTableHeader = document.getElementById('validation-table-header');
        const validationTableBody = document.getElementById('validation-table-body');
        const validationCampaignLabel = document.getElementById('validation-campaign-label');
        const addValidationRowButton = document.getElementById('add-validation-row');
        const saveDataButton = document.getElementById('save-data-button');
        const resetDataButton = document.getElementById('reset-data-button');
        const projectSelector = document.getElementById('project-selector');
        const newProjectButton = document.getElementById('new-project-button');
        const editProjectButton = document.getElementById('edit-project-button');
        const deleteProjectButton = document.getElementById('delete-project-button');
        const viewSampleButton = document.getElementById('view-sample-button');
        
        function updateProjectSelector() {
            projectSelector.innerHTML = '';
            Object.keys(storageData.projects).forEach(projectName => {
                const option = document.createElement('option');
                option.value = projectName;
                option.textContent = projectName === 'default' ? 'í”„ë¡œì íŠ¸ ëª…' : projectName;
                if (projectName === currentProject) {
                    option.selected = true;
                    if (projectName === 'default') option.classList.add('text-gray-500');
                }
                projectSelector.appendChild(option);
            });
            if(currentProject === 'default') projectSelector.classList.add('text-gray-500');
            else projectSelector.classList.remove('text-gray-500');
        }
        
        function togglePerfColumns() {
            isPerfInputVisible = !isPerfInputVisible;
            const perfCols = document.querySelectorAll('#validation-input-table .perf-col');
            perfCols.forEach(col => col.classList.toggle('hidden', !isPerfInputVisible));
            const perfToggleBtn = document.getElementById('toggle-perf-cols');
            if (perfToggleBtn) perfToggleBtn.textContent = isPerfInputVisible ? 'ì „í™˜ ì„±ê³¼ ìˆ¨ê¹€' : 'ì „í™˜ ì„±ê³¼ ì…ë ¥';
        }

        function toggleScoreColumns() {
            isScoreVisible = !isScoreVisible;
            const scoreCols = document.querySelectorAll('.score-col');
            scoreCols.forEach(col => col.classList.toggle('hidden', !isScoreVisible));
            const btns = document.querySelectorAll('.toggle-score-btn');
            btns.forEach(btn => btn.textContent = isScoreVisible ? 'ì ìˆ˜ ìˆ¨ê¹€' : 'ì ìˆ˜ ë³´ê¸°');
        }

        function toggleValidationTable() {
            isValidationTableOpen = !isValidationTableOpen;
            const toggleIcon = document.getElementById('toggle-icon');
            const toggleText = document.getElementById('toggle-text');
            if (isValidationTableOpen) {
                validationTableContent.classList.remove('hidden');
                toggleText.textContent = 'ì…ë ¥ í…Œì´ë¸” ì ‘ê¸°';
                toggleIcon.classList.add('rotate-180');
            } else {
                validationTableContent.classList.add('hidden');
                toggleText.textContent = 'ì…ë ¥ í…Œì´ë¸” ì—´ê¸°';
                toggleIcon.classList.remove('rotate-180');
            }
        }
        
        function calculateValidationMetrics(row) {
            const { cost, imp, click, conv } = row;
            const safeDivide = (n, d) => (typeof n!=='number'||typeof d!=='number'||d<=0||isNaN(n)||isNaN(d)||n===null||d===null) ? null : n/d;
            
            row.actualCpm = safeDivide(cost, imp) !== null ? safeDivide(cost, imp) * 1000 : null;
            row.actualCpc = safeDivide(cost, click);
            row.actualCtr = safeDivide(click, imp); 
            row.actualCvr = safeDivide(conv, click);
            row.actualCpa = safeDivide(cost, conv);
        }

        function updateCalculatedColumnsInDOM(rowId, rowData) {
            const rowElement = document.querySelector(`#validation-table-body tr[data-row-id="${rowId}"]`);
            if (!rowElement) return;
            const config = validationTableConfigs['MAIN'];
            config.cols.forEach((col, colIndex) => {
                if (col.calculated) {
                    const td = rowElement.children[colIndex]; 
                    if (!td) return;
                    const inputElement = td.querySelector('input');
                    if (!inputElement) return;
                    const rawValue = rowData[col.key];
                    let displayValue = '-';
                    if (rawValue !== null) {
                        if (col.type === 'currency') displayValue = formatNumber(Math.round(rawValue), 'currency').replace('ì›', ''); 
                        else if (col.type === 'percent') displayValue = `${(rawValue * 100).toFixed(2)}%`; 
                        else displayValue = rawValue.toFixed(2);
                    }
                    inputElement.value = displayValue;
                }
            });
        }
        
        function handleValidationInputChange(rowId, key, event) {
            const index = validationData['MAIN'].findIndex(r => r.id === rowId);
            if (index > -1) {
                const config = validationTableConfigs['MAIN'].cols.find(c => c.key === key);
                if (!config) return;
                let inputValue = event.target.value;
                let rawValueToStore = inputValue; 
                if (config.isLargeNumber) {
                    const cleanValue = inputValue.replace(/[^\d]/g, ''); 
                    event.target.value = formatNumericInput(cleanValue);
                    rawValueToStore = cleanValue === '' ? null : parseInt(cleanValue, 10);
                } else if (config.type === 'number' || config.type === 'currency' || config.type === 'percent') {
                    const cleanValue = inputValue.replace(/[^\d.]/g, ''); 
                    rawValueToStore = cleanValue === '' || cleanValue === '.' ? null : parseFloat(cleanValue);
                    if ((key.includes('targetCtr') || key.includes('targetCvr')) && rawValueToStore !== null) {
                        rawValueToStore = rawValueToStore / 100;
                    }
                } else if (config.type === 'text') {
                    rawValueToStore = inputValue;
                }
                validationData['MAIN'][index][key] = rawValueToStore;
                const baseMetrics = ['cost', 'imp', 'click', 'conv', 'revenue'];
                if (baseMetrics.includes(key)) {
                    calculateValidationMetrics(validationData['MAIN'][index]);
                    updateCalculatedColumnsInDOM(rowId, validationData['MAIN'][index]);
                }
            }
        }
        
        function addValidationRow() {
            const row = mapCampaignDataToValidation([{}])[0];
            validationData['MAIN'].push(row);
            renderValidationTable();
        }

        function removeValidationRow(rowId) {
            validationData['MAIN'] = validationData['MAIN'].filter(r => r.id !== rowId);
            if (validationData['MAIN'].length === 0) validationData['MAIN'].push(mapCampaignDataToValidation([{}])[0]);
            renderValidationTable();
            runAnalysis();
        }
        
        function renderValidationTable() {
            const config = validationTableConfigs['MAIN'];
            validationCampaignLabel.textContent = config.label;
            validationTableHeader.innerHTML = '';
            const trGroup = document.createElement('tr');
            trGroup.className = 'bg-gray-200 border-b-2 border-gray-300';
            config.headerGroups.forEach(group => {
                const th = document.createElement('th');
                th.className = 'px-2 py-2 text-xs font-bold text-gray-700 uppercase tracking-wider sticky top-0 bg-gray-300';
                th.colSpan = group.cols.length;
                if (group.name === 'í´ë¦­ ì„±ê³¼ (CPC/CTR)') {
                    th.innerHTML = `<div class="flex items-center justify-center relative"><span>${group.name}</span><button id="toggle-perf-cols" class="ml-2 text-xs bg-indigo-500 text-white rounded px-2 py-0.5 hover:bg-indigo-700 transition-colors">${isPerfInputVisible ? 'ì „í™˜ ì„±ê³¼ ìˆ¨ê¹€' : 'ì „í™˜ ì„±ê³¼ ì…ë ¥'}</button></div>`;
                } else th.textContent = group.name;
                if (group.name === 'ì „í™˜ ì„±ê³¼ (CPA)') {
                    th.classList.add('perf-col');
                    if (!isPerfInputVisible) th.classList.add('hidden');
                }
                trGroup.appendChild(th);
            });
            const perfToggleBtn = trGroup.querySelector('#toggle-perf-cols');
            if (perfToggleBtn) perfToggleBtn.addEventListener('click', (e) => { e.stopPropagation(); togglePerfColumns(); });
            const thDeleteTop = document.createElement('th');
            thDeleteTop.className = 'px-1 py-2 text-xs font-bold text-gray-700 sticky top-0 bg-gray-300 w-10';
            thDeleteTop.textContent = 'ì‚­ì œ';
            thDeleteTop.rowSpan = 2;
            trGroup.appendChild(thDeleteTop);
            validationTableHeader.appendChild(trGroup);
            const trDetail = document.createElement('tr');
            trDetail.className = 'bg-gray-100 border-b border-gray-200';
            config.cols.forEach(col => {
                const th = document.createElement('th');
                th.className = `px-2 py-2 text-xs font-semibold text-gray-700 uppercase tracking-wider sticky top-0 border-r border-gray-200 ${col.width || 'w-24'}`;
                if (col.key === 'cost') th.innerHTML = `${col.name} <span class="header-subtext">(ì†Œì§„ ê¸ˆì•¡)</span>`;
                else th.textContent = col.name;
                if (col.group === 'ì „í™˜ ì„±ê³¼ (CPA)') {
                    th.classList.add('perf-col');
                    if (!isPerfInputVisible) th.classList.add('hidden');
                }
                trDetail.appendChild(th);
            });
            validationTableHeader.appendChild(trDetail);
            validationTableBody.innerHTML = '';
            validationData['MAIN'].forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50 transition-colors';
                tr.dataset.rowId = row.id; 
                config.cols.forEach(col => {
                    const td = document.createElement('td');
                    td.className = 'p-1 text-xs whitespace-nowrap border-r border-gray-100';
                    if (col.group === 'ì „í™˜ ì„±ê³¼ (CPA)') {
                        td.classList.add('perf-col');
                        if (!isPerfInputVisible) td.classList.add('hidden');
                    }
                    let rawValue = row[col.key];
                    let displayValue = (rawValue === null || typeof rawValue === 'undefined') ? '' : rawValue;
                    if (col.calculated) {
                        if (rawValue !== null) {
                            if (col.type === 'currency') displayValue = formatNumber(Math.round(rawValue), 'currency').replace('ì›', '');
                            else if (col.type === 'percent') displayValue = `${(rawValue * 100).toFixed(2)}%`; 
                            else displayValue = rawValue.toFixed(2);
                        } else displayValue = '-';
                        td.innerHTML = `<input type="text" readonly class="w-full p-1 border rounded-md text-xs bg-indigo-50 font-semibold text-indigo-700 pointer-events-none text-center" value="${displayValue}">`;
                    } else {
                        let inputClasses = `w-full p-1 border rounded-md text-xs focus:ring-indigo-500 focus:border-indigo-500 ${['number','currency','percent'].includes(col.type) || col.isLargeNumber ? 'text-right' : 'text-left'}`;
                        if (col.isLargeNumber && typeof rawValue === 'number') displayValue = formatNumericInput(rawValue);
                        else if (col.type === 'percent' && typeof rawValue === 'number') displayValue = `${(rawValue * 100).toFixed(2).replace(/\.00$/, '')}%`;
                        if (isPrefillActive && row.isPrefill && (displayValue || displayValue === 0)) inputClasses += ' input-prefill';
                        const input = document.createElement('input');
                        input.type = 'text'; input.className = inputClasses; input.value = displayValue;
                        input.placeholder = col.placeholder; input.dataset.key = col.key;
                        input.addEventListener('focus', (e) => {
                            if (isPrefillActive) {
                                isPrefillActive = false;
                                validationData['MAIN'].forEach(r => { 
                                    r.actualCpm=null; r.actualCpc=null; r.actualCtr=null; r.actualCvr=null; r.actualCpa=null; 
                                    if(r.isPrefill) { r.isPrefill=false; config.cols.forEach(c => { if(!c.calculated) r[c.key]=null; }); }
                                });
                                renderValidationTable(); return;
                            }
                            e.target.classList.remove('input-prefill');
                        });
                        input.addEventListener('blur', (e) => {
                             handleValidationInputChange(row.id, col.key, e);
                             if(col.type==='percent' && !e.target.value.includes('%') && validationData['MAIN'].find(r=>r.id===row.id)[col.key]!==null) e.target.value += '%';
                        });
                        input.addEventListener('input', (e) => { e.target.classList.remove('input-prefill'); handleValidationInputChange(row.id, col.key, e); });
                        td.appendChild(input);
                    }
                    tr.appendChild(td);
                });
                const actionTd = document.createElement('td');
                actionTd.className = 'p-1 text-center';
                actionTd.innerHTML = `<button class="text-red-500 hover:text-red-700 font-bold text-sm p-1">X</button>`;
                actionTd.querySelector('button').addEventListener('click', () => removeValidationRow(row.id));
                tr.appendChild(actionTd);
                validationTableBody.appendChild(tr);
            });
        }
        
        // [MODIFY] Updated Scoring Logic (Strict Criteria)
        const getScoreCpm = (a, t) => {
            if (a===null||t===null||t<=0) return 1;
            const r = a/t;
            if (r < 0.70) return 5;  
            if (r <= 0.90) return 4; 
            if (r <= 1.05) return 3; 
            if (r <= 1.25) return 2; 
            return 1;                
        };

        const getScoreCtr = (a, t) => {
            if (a===null||t===null||t<=0) return 1;
            const r = a/t;
            if (r > 1.50) return 5;  
            if (r >= 1.15) return 4; 
            if (r >= 0.95) return 3; 
            if (r >= 0.75) return 2; 
            return 1;                
        };

        const getScoreCpc = (a, t) => {
            if (a===null||t===null||t<=0) return 1;
            const r = a/t;
            if (r < 0.70) return 5;  
            if (r <= 0.90) return 4; 
            if (r <= 1.05) return 3; 
            if (r <= 1.25) return 2; 
            return 1;                
        };

        const getScoreCvr = (a, t) => (a===null||t===null||t<=0)?null:(a/t>1.50?5:a/t>=1.15?4:a/t>=0.95?3:a/t>=0.75?2:1);
        const getScoreCpa = (a, t) => (a===null||t===null||t<=0)?null:(a/t<0.70?5:a/t<=0.90?4:a/t<=1.05?3:a/t<=1.25?2:1);

        const getDaInsight = (sA, sB) => {
            if (sA >= 4 && sB >= 4) return { grade: "Top ì†Œì¬", text: "ë…¸ì¶œì´ ë§¤ìš° ì›í™œí•˜ê³ , ì†Œì¬ ê´€ì‹¬ë„ë„ ë§¤ìš° ë†’ì•„ íƒ€ê²ŸíŒ…ê³¼ ë©”ì‹œì§€ íš¨ê³¼ì ì¸ ì†Œì¬" };
            if (sA >= 4 && sB >= 3) return { grade: "Top ì†Œì¬", text: "ë…¸ì¶œì´ ë§¤ìš° ì›í™œí•˜ê³ , ì†Œì¬ ê´€ì‹¬ì€ ìš°ìˆ˜í•œ í¸ì´ë¯€ë¡œ ì¢€ ë” ë²”ìš©ì ì¸ ì†Œì¬ë¡œ ê°œì„  í•„ìš”" };
            if (sA >= 4 && sB >= 1.5) return { grade: "Mid ì†Œì¬", text: "ë…¸ì¶œì€ ë§¤ìš° ì›í• í•˜ì§€ë§Œ, ì†Œì¬ ê´€ì‹¬ì´ ë‚®ì€ í¸ìœ¼ë¡œ í›…í‚¹ì„±ì„ ë†’ì¸ ì†Œì¬ë¡œ ìˆ˜ì • í•„ìš”" };
            if (sA >= 4 && sB >= 0) return { grade: "Lowì†Œì¬", text: "ë…¸ì¶œì€ ë§¤ìš° ì›í™œí•˜ì§€ë§Œ ê·¹ì†Œìˆ˜ì˜ ì§‘ë‹¨ì—ì„œ ë°˜ì‘ì´ ë°œìƒí•¨ìœ¼ë¡œ ì†Œì¬ í›…í‚¹ì„± ì¦ëŒ€ í•„ìš”" };
            if (sA >= 3 && sB >= 4) return { grade: "Top ì†Œì¬", text: "ë…¸ì¶œì´ ì ì ˆí•˜ë©°, ì†Œì¬ ê´€ì‹¬ì´ ë§¤ìš° ë†’ì•„ ë©”ì‹œì§€ íš¨ê³¼ì„±ì´ ë†’ì€ ì†Œì¬" };
            if (sA >= 3 && sB >= 3) return { grade: "Topì†Œì¬", text: "ë…¸ì¶œì´ ì ì ˆí•˜ê³ , ì†Œì¬ ê´€ì‹¬ë„ ë™ë°˜ë˜ì–´ ìš°ìˆ˜í•œ ì†Œì¬" };
            if (sA >= 3 && sB >= 1.5) return { grade: "Mid ì†Œì¬", text: "ë…¸ì¶œì€ ì ì ˆí•˜ì§€ë§Œ ì†Œì¬ ê´€ì‹¬ì´ ë‚®ì€ í¸ìœ¼ë¡œ íƒ€ê²ŸíŒ… í™•ì¥ ë° ë²”ìš©ì ì¸ ì†Œì¬ë¡œ ê°œì„  í•„ìš”" };
            if (sA >= 3 && sB >= 0) return { grade: "Lowì†Œì¬", text: "ë…¸ì¶œì€ ì ì ˆí•˜ì§€ë§Œ ê´€ì‹¬ì´ ì €ì¡°í•˜ì—¬ ì†Œì¬ OFF ë° ì˜ˆì‚° ì´ê´€ ê³ ë ¤" };
            if (sA >= 1.5 && sB >= 4) return { grade: "Midì†Œì¬", text: "ì†Œì¬ ê´€ì‹¬ì´ ë§¤ìš° ë†’ì§€ë§Œ ë…¸ì¶œì´ ì›í™œí•˜ì§€ ì•ŠëŠ” ì†Œì¬ë¡œ íƒ€ê²ŸíŒ… ì¡°ì • ë° ì˜ˆì‚° ì¦ì•¡ìœ¼ë¡œ ë…¸ì¶œ ì¦ëŒ€ë°©ì•ˆ ê³ ë ¤" };
            if (sA >= 1.5 && sB >= 3) return { grade: "Lowì†Œì¬", text: "ì†Œì¬ í›…í‚¹ì„±ì€ ìˆì§€ë§Œ ë…¸ì¶œì´ ì›í™œí•˜ì§€ ì•ŠëŠ” ì†Œì¬ë¡œ íƒ€ê²ŸíŒ… í™•ì¥ í•„ìš”" };
            if (sA >= 1.5 && sB >= 1.5) return { grade: "Lowì†Œì¬", text: "ë…¸ì¶œê³¼ ì†Œì¬ ê´€ì‹¬ì´ ë‚®ì€ í¸ìœ¼ë¡œ ì†Œì¬ OFF ë° ì˜ˆì‚° ì´ê´€ ê³ ë ¤" };
            if (sA >= 1.5 && sB >= 0) return { grade: "Lowì†Œì¬", text: "ë…¸ì¶œê³¼ ì†Œì¬ ê´€ì‹¬ì´ ì €ì¡°í•˜ì—¬ ì†Œì¬ OFF ë° ì˜ˆì‚° ì´ê´€ ê³ ë ¤" };
            if (sA >= 0 && sB >= 4) return { grade: "Lowì†Œì¬", text: "ì†Œì¬ ê´€ì‹¬ì€ ë§¤ìš° ë†’ì§€ë§Œ ê·¹ì†Œìˆ˜ì˜ ì§‘ë‹¨ì—ë§Œ ë…¸ì¶œë˜ì–´ íƒ€ê²ŸíŒ… í™•ì¥ ë° ì˜ˆì‚° ì¦ì•¡ìœ¼ë¡œ ë…¸ì¶œ ì¦ëŒ€ë°©ì•ˆ ê³ ë ¤" };
            if (sA >= 0 && sB >= 3) return { grade: "Lowì†Œì¬", text: "ì†Œì¬ í›…í‚¹ì„±ì€ ìˆì§€ë§Œ ê·¹ì†Œìˆ˜ì˜ ì§‘ë‹¨ì—ë§Œ ë…¸ì¶œë˜ì–´ íƒ€ê²ŸíŒ… ì¡°ì • í•„ìš”" };
            if (sA >= 0 && sB >= 1.5) return { grade: "Lowì†Œì¬", text: "ë…¸ì¶œì´ ì €ì¡°í•˜ê³  ì†Œì¬ ê´€ì‹¬ì´ ë‚®ì€ í¸ìœ¼ë¡œ ì†Œì¬ OFF ë° ì˜ˆì‚° ì´ê´€ ê³ ë ¤" };
            if (sA >= 0 && sB >= 0) return { grade: "Lowì†Œì¬", text: "ë…¸ì¶œê³¼ ì†Œì¬ ê´€ì‹¬ì´ ì €ì¡°í•˜ì—¬ ì†Œì¬ OFF ë° ì˜ˆì‚° ì´ê´€ ê³ ë ¤" };
            return { grade: "ì˜¤ë¥˜", text: "ì ìˆ˜ ê³„ì‚° ì˜¤ë¥˜" };
        };
        const getDaFeedback = (sA, sB) => {
            if (sA === null || sB === null) return '';
            if (sA >= 4 && sB >= 4) return "ìœ ì§€/ê°•í™”";
            if (sA >= 4 && sB >= 3) return "ë²”ìš©ì  ë©”ì‹œì§€ ê°•í™”";
            if (sA >= 4 && sB >= 1.5) return "í›…í‚¹ì„± ì¦ëŒ€";
            if (sA >= 4 && sB >= 0) return "í›…í‚¹ì„± ì¦ëŒ€";
            if (sA >= 3 && sB >= 4) return "ìœ ì§€/ê°•í™”";
            if (sA >= 3 && sB >= 3) return "ìœ ì§€/ê°•í™”";
            if (sA >= 3 && sB >= 1.5) return "íƒ€ê²ŸíŒ… í™•ì¥/ë²”ìš©ì  ë©”ì‹œì§€";
            if (sA >= 3 && sB >= 0) return "íƒ€ê²ŸíŒ… í™•ì¥+í›…í‚¹ì„± ì¦ëŒ€";
            if (sA >= 1.5 && sB >= 4) return "íƒ€ê²ŸíŒ… í™•ì¥+ì˜ˆì‚° ì¦ëŒ€";
            if (sA >= 1.5 && sB >= 3) return "íƒ€ê²ŸíŒ… ì¡°ì •";
            if (sA >= 1.5 && sB >= 1.5) return "ì˜ˆì‚°ì´ê´€";
            if (sA >= 1.5 && sB >= 0) return "ì˜ˆì‚°ì´ê´€";
            if (sA >= 0 && sB >= 4) return "íƒ€ê²ŸíŒ… í™•ì¥+ì˜ˆì‚° ì¦ëŒ€";
            if (sA >= 0 && sB >= 3) return "íƒ€ê²ŸíŒ… ì¡°ì •+í›…í‚¹ì„± ì¦ëŒ€";
            if (sA >= 0 && sB >= 1.5) return "ì˜ˆì‚°ì´ê´€";
            if (sA >= 0 && sB >= 0) return "ì˜ˆì‚°ì´ê´€";
            return "";
        };
        const getPerfInsight = (sB, sC) => {
            if (sB === null || sC === null) return { grade: "ë°ì´í„° ë¶€ì¡±", text: "í¼í¬ë¨¼ìŠ¤ ì„±ê³¼ ë¶„ì„ ë¶ˆê°€" };
            if (sB >= 4 && sC >= 4) return { grade: "Top ì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ê³¼ ì „í™˜ íš¨ìœ¨ì´ ë§¤ìš° ë†’ì•„ ë©”ì‹œì§€ê°€ ì›Œí‚¹í•˜ëŠ” ì†Œì¬" };
            if (sB >= 4 && sC >= 3) return { grade: "Top ì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì€ ë§¤ìš° ë†’ì§€ë§Œ ì „í™˜ íš¨ìœ¨ì€ ìš°ìˆ˜í•œ í¸ìœ¼ë¡œ ì•¡ì…˜ì— ë‹¤ì†Œ ì‹ ì¤‘í•œ íƒœë„ë¥¼ ë³´ì´ëŠ” ê²ƒìœ¼ë¡œ ì˜ˆìƒ" };
            if (sB >= 4 && sC >= 1.5) return { grade: "Mid ì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì€ ë§¤ìš° ë†’ì§€ë§Œ ì „í™˜ íš¨ìœ¨ì´ ë‚®ì€ í¸ìœ¼ë¡œ íƒ€ ìƒí’ˆê³¼ ë¹„êµ ì¤‘ì´ê±°ë‚˜ ì „í™˜ í”„ë¡œì„¸ìŠ¤ì— í—ˆë“¤ì´ ìˆì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒ" };
            if (sB >= 4 && sC >= 0) return { grade: "Lowì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì€ ë§¤ìš° ë†’ì§€ë§Œ ì „í™˜ íš¨ìœ¨ì´ ì €ì¡°í•œ ì†Œì¬ë¡œ í˜¸ê¸°ì‹¬ì€ ìˆì§€ë§Œ ìƒí’ˆ ê´€ì‹¬ ìì²´ê°€ ì—†ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒ" };
            if (sB >= 3 && sC >= 4) return { grade: "Top ì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì€ ì ì ˆí•œ ë°˜ë©´ ì „í™˜ íš¨ìœ¨ì€ ë§¤ìš° ë†’ì€ í¸ìœ¼ë¡œ í•œ ë²ˆì— ë‹¤ìˆ˜ ì•¡ì…˜ì´ ë°œìƒí•˜ê±°ë‚˜ ë°”ì´ëŸ´ ëœ ê²ƒìœ¼ë¡œ ì˜ˆìƒ" };
            if (sB >= 3 && sC >= 3) return { grade: "Topì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ê³¼ ì „í™˜ íš¨ìœ¨ì´ ìš°ìˆ˜í•œ í¸ì´ì§€ë§Œ ì•¡ì…˜ì— ë‹¤ì†Œ ì‹ ì¤‘í•œ íƒœë„ë¥¼ ë³´ì´ê³  ìˆì–´ì„œ ë² ë„¤í• ê°•ì¡° ì‹œ ê°œì„  ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒ" }; 
            if (sB >= 3 && sC >= 1.5) return { grade: "Mid ì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì€ ì ì ˆí•˜ì§€ë§Œ ì „í™˜ íš¨ìœ¨ì´ ë‚®ì€ í¸ìœ¼ë¡œ íƒ€ ìƒí’ˆê³¼ ë¹„êµ ì¤‘ì´ê±°ë‚˜ ì „í™˜ í”„ë¡œì„¸ìŠ¤ì— í—ˆë“¤ì´ ìˆì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒ" };
            if (sB >= 3 && sC >= 0) return { grade: "Lowì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì€ ì ì ˆí•˜ì§€ë§Œ ì „í™˜ íš¨ìœ¨ì´ ì €ì¡°í•œ ì†Œì¬ë¡œ ìƒí’ˆ ê´€ì‹¬ ìì²´ê°€ ì—†ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒ" };
            if (sB >= 1.5 && sC >= 4) return { grade: "Midì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì€ ë‚®ì§€ë§Œ ì „í™˜ íš¨ìœ¨ì´ ë§¤ìš° ë†’ì€ í¸ìœ¼ë¡œ ë§¤ë‹ˆì•„ì¸µì´ ìˆê±°ë‚˜ ë°”ì´ëŸ´ ëœ ê²ƒìœ¼ë¡œ ì˜ˆìƒ" };
            if (sB >= 1.5 && sC >= 3) return { grade: "Midì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì€ ë‚®ì§€ë§Œ ì „í™˜ íš¨ìœ¨ì´ ìš°ìˆ˜í•œ í¸ìœ¼ë¡œ ë§¤ë‹ˆì•„ì¸µì´ ìˆëŠ” ê²ƒìœ¼ë¡œ ì˜ˆìƒ" };
            if (sB >= 1.5 && sC >= 1.5) return { grade: "Lowì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ê³¼ ì „í™˜ íš¨ìœ¨ì´ ë‚®ì€ í¸ìœ¼ë¡œ ì†Œì¬ OFF ë° ì˜ˆì‚° ì´ê´€ ê³ ë ¤" };
            if (sB >= 1.5 && sC >= 0) return { grade: "Lowì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì´ ë‚®ì€ í¸ì´ê³  ì „í™˜ íš¨ìœ¨ì´ ì €ì¡°í•˜ì—¬ ì†Œì¬ OFF ë° ì˜ˆì‚° ì´ê´€ ê³ ë ¤" };
            if (sB >= 0 && sC >= 4) return { grade: "Midì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì€ ì €ì¡°í•˜ì§€ë§Œ ì „í™˜ íš¨ìœ¨ì´ ë§¤ìš° ë†’ì€ í¸ìœ¼ë¡œ ë§¤ë‹ˆì•„ì¸µì´ ìˆê±°ë‚˜ ë°”ì´ëŸ´ ëœ ê²ƒìœ¼ë¡œ ì˜ˆìƒ" };
            if (sB >= 0 && sC >= 3) return { grade: "Lowì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì€ ì €ì¡°í•˜ì§€ë§Œ ì „í™˜ íš¨ìœ¨ì´ ìš°ìˆ˜í•œ í¸ìœ¼ë¡œ ë§¤ë‹ˆì•„ì¸µì´ ìˆëŠ” ê²ƒìœ¼ë¡œ ì˜ˆìƒ" };
            if (sB >= 0 && sC >= 1.5) return { grade: "Lowì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ì´ ì €ì¡°í•˜ê³  ì „í™˜ íš¨ìœ¨ì´ ë‚®ì€ í¸ìœ¼ë¡œ ì†Œì¬ OFF ë° ì˜ˆì‚° ì´ê´€ ê³ ë ¤" };
            if (sB >= 0 && sC >= 0) return { grade: "Lowì†Œì¬", text: "ê´‘ê³  ë°˜ì‘ê³¼ ì „í™˜ íš¨ìœ¨ì´ ëª¨ë‘ ì €ì¡°í•˜ì—¬ ì†Œì¬ OFF ë° ì˜ˆì‚° ì´ê´€ ê³ ë ¤" };
            return { grade: "ì˜¤ë¥˜", text: "í¼í¬ë¨¼ìŠ¤ ì ìˆ˜ ê³„ì‚° ì˜¤ë¥˜" };
        };
        const getPerfFeedback = (sB, sC) => {
            if (sB === null || sC === null) return '';
            if (sB >= 4 && sC >= 4) return "ìœ ì§€/ê°•í™”";
            if (sB >= 4 && sC >= 3) return "ê²°ì •ì ì¸ ë² ë„¤í• ê°•ì¡°";
            if (sB >= 4 && sC >= 1.5) return "íƒ€ì‚¬ ëŒ€ë¹„ ê°•ì  ê°•ì¡° / ì•¡ì…˜ í—ˆë“¤ ì ê²€";
            if (sB >= 4 && sC >= 0) return "íŒë§¤ ìƒí’ˆ êµì²´";
            if (sB >= 3 && sC >= 4) return "ìœ ì§€/ê°•í™”";
            if (sB >= 3 && sC >= 3) return "ê²°ì •ì ì¸ ë² ë„¤í• ê°•ì¡°";
            if (sB >= 3 && sC >= 1.5) return "íƒ€ì‚¬ ëŒ€ë¹„ ê°•ì  ê°•ì¡° / ì•¡ì…˜ í—ˆë“¤ ì ê²€";
            if (sB >= 3 && sC >= 0) return "íŒë§¤ ìƒí’ˆ êµì²´";
            if (sB >= 1.5 && sC >= 4) return "í›…í‚¹ì„± ì¦ëŒ€ / íƒ€ê²ŸíŒ… í™•ì¥";
            if (sB >= 1.5 && sC >= 3) return "í›…í‚¹ì„± ì¦ëŒ€";
            if (sB >= 1.5 && sC >= 1.5) return "ì˜ˆì‚°ì´ê´€";
            if (sB >= 1.5 && sC >= 0) return "ì˜ˆì‚°ì´ê´€";
            if (sB >= 0 && sC >= 4) return "í›…í‚¹ì„± ì¦ëŒ€ / íƒ€ê²ŸíŒ… í™•ì¥";
            if (sB >= 0 && sC >= 3) return "í›…í‚¹ì„± ì¦ëŒ€";
            if (sB >= 0 && sC >= 1.5) return "ì˜ˆì‚°ì´ê´€";
            if (sB >= 0 && sC >= 0) return "ì˜ˆì‚°ì´ê´€";
            return "";
        };
        const getRoasInsight = (roas, prefix) => {
            if (roas === null || isNaN(roas) || roas <= 0) return null;
            let grade="1ì ", text="ê´‘ê³ ë¹„ ì†Œì§„ ëŒ€ë¹„ ì†ìµë¶„ê¸° ë¯¸ë‹¬ì´ê±°ë‚˜ ë‹¨ìˆœ ë³¸ì „ì„ ë‹¬ì„±í•œ ê²ƒìœ¼ë¡œ íŒë‹¨ë¨";
            if (roas > 600) { grade="5ì "; text="ì••ë„ì ì¸ ìˆ˜ìµì´ ë°œìƒë˜ëŠ” ì†Œì¬ë¡œ ì¦‰ê°ì ì¸ ì˜ˆì‚° ì¦ì•¡ì„ í†µí•œ ìœ ì§€ê°•í™” í•„ìš”"; }
            else if (roas >= 400) { grade="4ì "; text="ë†’ì€ ìˆœì´ìµì„ ê¸°ë¡í•˜ëŠ” ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë©° ì˜ˆì‚° ì¦ì•¡ì„ í†µí•œ ìœ ì§€ê°•í™” ê¶Œì¥"; }
            else if (roas >= 250) { grade="3ì "; text="ìˆœì´ìµì´ ë°œìƒë˜ëŠ” êµ¬ê°„ì— ì§„ì…í•œ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë©° ì¶”ì´ë¥¼ ì§€ì¼œë³¸ í›„ ì˜ˆìƒ ì¦ì•¡ ì—¬ë¶€ íŒë‹¨ì„ ê¶Œì¥"; }
            else if (roas >= 150) { grade="2ì "; text="ì†ìµë¶„ê¸°ì— ê·¼ì ‘í•˜ê±°ë‚˜ ì†Œí­ ìˆœì´ìµì„ ê¸°ë¡í•˜ëŠ” ìƒí™©ìœ¼ë¡œ ì˜ˆìƒ ë¨"; }
            return { grade, text: `${prefix}: [ROAS ${Math.round(roas)}% (${grade})] ${text}` };
        };

        function calculateScoresAndInsight(row) {
            let sA=null, sB=null, sC=null, total=null, insight='ë°ì´í„° ë¶€ì¡±', color='#94a3b8', mInsight='ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
            let daGrade=null, daFeed='', pmGrade=null, pmFeed='';
            
            // [FIX] Color separation logic
            let daColor = '#94a3b8';
            let pmColor = '#94a3b8';

            const prefix = (row.media || row.placement || row.creativeName) ? `${row.media || 'N/A'}/${row.placement || 'N/A'}/${row.creativeName || 'N/A'}` : 'ë§¤ì²´ ìƒí’ˆê³¼ ì†Œì¬ëª… ì—†ìŒ';
            
            const daMiss = row.cost===null||row.cost===0||row.imp===null||row.imp===0||row.click===null||row.targetCpm===null||row.targetCpc===null||row.targetCtr===null;
            if (!daMiss) {
                sA = getScoreCpm(row.actualCpm, row.targetCpm);
                const b1 = getScoreCtr(row.actualCtr, row.targetCtr);
                const b2 = getScoreCpc(row.actualCpc, row.targetCpc);
                sB = (b1 + b2) / 2;
                const daRes = getDaInsight(sA, sB);
                daGrade = daRes.grade;
                daFeed = getDaFeedback(sA, sB);
                
                // DA Color Logic
                if (daGrade.includes("Top")) daColor = '#10b981';
                else if (daGrade.includes("Mid")) daColor = '#f59e0b';
                else if (daGrade.includes("Low")) daColor = '#ef4444';
            }

            const perfMiss = row.conv===null||row.targetCvr===null||row.targetCpa===null||row.click===null||row.click===0;
            if (!perfMiss && row.actualCvr!==null && row.actualCpa!==null) {
                const sc1 = getScoreCvr(row.actualCvr, row.targetCvr);
                const sc2 = getScoreCpa(row.actualCpa, row.targetCpa);
                if (sc1!==null && sc2!==null) {
                    sC = (sc1 + sc2) / 2;
                    const pmRes = getPerfInsight(sB, sC);
                    pmGrade = pmRes.grade;
                    pmFeed = getPerfFeedback(sB, sC);
                    
                    // PM Color Logic
                    if (pmGrade.includes("Top")) pmColor = '#10b981';
                    else if (pmGrade.includes("Mid")) pmColor = '#f59e0b';
                    else if (pmGrade.includes("Low")) pmColor = '#ef4444';
                }
            }
            
            // Determine main insight for table display (fallback priority)
            if (sC!==null && sB!==null) {
                insight = pmGrade;
                mInsight = `${getPerfInsight(sB, sC).text}`; 
            } else if (sA!==null && sB!==null) {
                insight = daGrade;
                mInsight = `${getDaInsight(sA, sB).text}`; 
            }
            
            // Main color (for table badge)
            if (insight.includes("Top")) color = '#10b981';
            else if (insight.includes("Mid")) color = '#f59e0b';
            else if (insight.includes("Low")) color = '#ef4444';
            
            if (sA!==null && sB!==null) {
                if (sC!==null) total = (sA + sB + sC) / 3;
                else total = (sA + sB) / 2;
            }
            
            if (daMiss) {
                insight='ë¯¸ë””ì–´ ì„±ê³¼ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”'; mInsight=`${insight}`; color='#94a3b8';
            }

            return { 
                ...row, scoreA: sA?parseFloat(sA.toFixed(2)):null, scoreB: sB?parseFloat(sB.toFixed(2)):null, scoreC: sC?parseFloat(sC.toFixed(2)):null, 
                total: total?parseFloat(total.toFixed(2)):null, insight, color, mediaInsight: mInsight,
                daInsight: daGrade, daAction: daFeed, pmInsight: pmGrade, pmAction: pmFeed,
                roas: (row.cost > 0 && row.revenue !== null) ? (row.revenue / row.cost) * 100 : 0,
                daColor, pmColor // Return separated colors
            };
        }
        
        function aggregateAndScoreData(dataSource) {
            const raw = dataSource || validationData['MAIN'];
            const scored = raw.filter(r => r.media||r.creativeName||r.cost!==null).map(r => { calculateValidationMetrics(r); return calculateScoresAndInsight(r); });
            
            let tCost=0, tImp=0, tClick=0, tConv=0, tRev=0;
            scored.forEach(i => { tCost+=i.cost||0; tImp+=i.imp||0; tClick+=i.click||0; tConv+=i.conv||0; tRev+=i.revenue||0; });
            
            const avgCpm = tImp>0?(tCost/tImp)*1000:0;
            const avgCtr = tImp>0?tClick/tImp:0;
            const avgCpc = tClick>0?tCost/tClick:0;
            const avgCvr = tClick>0?tConv/tClick:0;
            const avgCpa = tConv>0?tCost/tConv:0;
            const avgRoas = tCost>0?(tRev/tCost)*100:0;

            return {
                data: scored,
                summary: [
                    { label: 'ì´ ê´‘ê³ ë¹„', value: tCost, type: 'currency' },
                    { label: 'ì´ ë…¸ì¶œìˆ˜', value: tImp, type: 'number', subMetrics: [{ label: 'ì„±ê³¼ CPM', value: avgCpm, type: 'currency' }] },
                    { label: 'ì´ í´ë¦­ìˆ˜', value: tClick, type: 'number', subMetrics: [{ label: 'ì„±ê³¼ CPC', value: avgCpc, type: 'currency' }, { label: 'ì„±ê³¼ CTR', value: avgCtr, type: 'percent' }] },
                    { label: 'ì´ ì „í™˜ìˆ˜', value: tConv, type: 'number', subMetrics: [{ label: 'ì„±ê³¼ CVR', value: avgCvr, type: 'percent' }, { label: 'ì„±ê³¼ CPA', value: avgCpa, type: 'currency' }] },
                    { label: 'ì´ ë§¤ì¶œì•¡', value: tRev, type: 'currency', subMetrics: [{ label: 'ì„±ê³¼ ROAS', value: avgRoas, type: 'percent' }] },
                ],
                headers: campaignData['MAIN'].headers
            };
        }

        function renderChart(data) {
            const matrixContainer = document.getElementById(data.isSample ? 'sample-quadrant-matrix' : 'quadrant-matrix');
            if (!matrixContainer) return;
            
            matrixContainer.querySelectorAll('.chart-dot, .chart-dot-perf, .chart-dot-grouped').forEach(d => d.remove());
            
            if (!data || data.data.length === 0) return;
            
            const W = matrixContainer.getBoundingClientRect().width;
            const H = 480;
            const PADDING = 25;
            const scaleX = (W - 2 * PADDING) / 5;
            const scaleY = (H - 2 * PADDING) / 5;
            
            // Pre-calculate positions to detect overlap
            const positions = {}; // Key: "x,y", Value: Array of items
            
            data.data.forEach((item, index) => {
                if (item.scoreA && item.scoreB) {
                    const x = PADDING + (item.scoreA * scaleX);
                    const y = H - PADDING - (item.scoreB * scaleY);
                    const key = `${Math.round(x)},${Math.round(y)}`;
                    if(!positions[key]) positions[key] = [];
                    positions[key].push({type: 'da', item, index, x, y});
                }
                if (item.scoreC && item.scoreB) {
                    const x = PADDING + (item.scoreC * scaleX);
                    const y = H - PADDING - (item.scoreB * scaleY);
                    const key = `${Math.round(x)},${Math.round(y)}`;
                    if(!positions[key]) positions[key] = [];
                    positions[key].push({type: 'pm', item, index, x, y});
                }
            });

            // Render dots (Grouped if needed)
            Object.values(positions).forEach(group => {
                if(group.length > 1) {
                    // Render Grouped Dot
                    const first = group[0];
                    const dot = document.createElement('div');
                    dot.className = 'chart-dot-grouped';
                    dot.style.left = `${Math.max(PADDING, Math.min(W-PADDING, first.x)) - 8}px`;
                    dot.style.top = `${Math.max(PADDING, Math.min(H-PADDING, first.y)) - 8}px`;
                    
                    dot.addEventListener('mouseenter', (e) => {
                        const tooltip = document.getElementById('chart-tooltip');
                        let html = `<div class="font-bold border-b pb-1 mb-1 text-sm">ì¤‘ë³µëœ ì†Œì¬ (${group.length})</div>`;
                        group.forEach(g => {
                            // [FIX] Detailed Tooltip for Grouped Dots
                            const typeLabel = g.type === 'da' ? 'DA' : 'PM';
                            const grade = g.type === 'da' ? g.item.daInsight : g.item.pmInsight;
                            const scoreA = g.item.scoreA !== null ? g.item.scoreA.toFixed(1) : 'N/A';
                            const scoreC = g.item.scoreC !== null ? g.item.scoreC.toFixed(1) : 'N/A';
                            const scoreB = g.item.scoreB.toFixed(1);
                            
                            // DA/PM Specific Score Display
                            let scoreDetail = '';
                            let totalScore = '';
                            if (g.type === 'da') {
                                scoreDetail = `DA ì„±ê³¼ : ë…¸ì¶œ ${scoreA} / ë°˜ì‘ ${scoreB}`;
                                totalScore = `DA ì„±ê³¼ ì´ì  : ${((g.item.scoreA + g.item.scoreB)/2).toFixed(2)}`;
                            } else {
                                scoreDetail = `PM ì„±ê³¼ : ì „í™˜ ${scoreC} / ë°˜ì‘ ${scoreB}`;
                                totalScore = `PM ì„±ê³¼ ì´ì  : ${((g.item.scoreC + g.item.scoreB)/2).toFixed(2)}`;
                            }

                            html += `<div class="mb-3 text-xs border-b border-gray-700 pb-2 last:border-0">
                                <div class="font-bold text-sm text-white mb-1">${g.item.media}/${g.item.placement}/${g.item.creativeName}</div>
                                <div class="mb-1">ë“±ê¸‰ : ${grade} (${typeLabel})</div>
                                <div class="text-indigo-300 mb-0.5">${scoreDetail}</div>
                                <div class="text-gray-400">${totalScore}</div>
                            </div>`;
                        });
                        tooltip.innerHTML = html;
                        tooltip.classList.add('opacity-100');
                        const moveFn = (ev) => {
                            const tw = tooltip.offsetWidth, th = tooltip.offsetHeight;
                            let tx = ev.clientX + 15, ty = ev.clientY - 15;
                            if (tx + tw > window.innerWidth) tx = ev.clientX - tw - 15;
                            if (ty < 0) ty = ev.clientY + 15;
                            tooltip.style.left = `${tx}px`; tooltip.style.top = `${ty}px`;
                        };
                        moveFn(e);
                        dot.addEventListener('mousemove', moveFn);
                        dot.addEventListener('mouseleave', () => { tooltip.classList.remove('opacity-100'); dot.removeEventListener('mousemove', moveFn); }, {once:true});
                    });
                    matrixContainer.appendChild(dot);
                } else {
                    // Single Dot
                    const g = group[0];
                    const dot = document.createElement('div');
                    dot.className = g.type === 'da' ? 'chart-dot' : 'chart-dot-perf';
                    // [FIX] Use specific color (daColor or pmColor)
                    dot.style.backgroundColor = g.type === 'da' ? g.item.daColor : g.item.pmColor;
                    
                    dot.style.left = `${Math.max(PADDING, Math.min(W-PADDING, g.x)) - 7}px`;
                    dot.style.top = `${Math.max(PADDING, Math.min(H-PADDING, g.y)) - 7}px`;
                    
                    dot.addEventListener('mouseenter', (e) => {
                        const tooltip = document.getElementById('chart-tooltip');
                        const mediaName = `${g.item.media}/${g.item.placement}/${g.item.creativeName}`;
                        let html = `<div class="font-bold text-base">${mediaName}</div>`;
                        
                        if (g.type === 'da') {
                            html += `<div class="mt-1">ë“±ê¸‰: ${g.item.daInsight || 'N/A'} (DA)</div>
                                     <div class="mt-0.5 text-xs text-indigo-300">DA ì„±ê³¼ : ë…¸ì¶œ ${g.item.scoreA} / ë°˜ì‘ ${g.item.scoreB}</div>
                                     <div class="mt-1 text-xs text-gray-400">DA ì„±ê³¼ ì´ì : ${((g.item.scoreA+g.item.scoreB)/2).toFixed(2)}</div>`;
                        } else {
                            html += `<div class="mt-1">ë“±ê¸‰: ${g.item.pmInsight || 'N/A'} (PM)</div>
                                     <div class="mt-0.5 text-xs text-green-300">PM ì„±ê³¼ : ì „í™˜ ${g.item.scoreC} / ë°˜ì‘ ${g.item.scoreB}</div>
                                     <div class="mt-1 text-xs text-gray-400">PM ì„±ê³¼ ì´ì : ${((g.item.scoreC+g.item.scoreB)/2).toFixed(2)}</div>`;
                        }
                        tooltip.innerHTML = html;
                        tooltip.classList.add('opacity-100');
                        const moveFn = (ev) => {
                            const tw = tooltip.offsetWidth, th = tooltip.offsetHeight;
                            let tx = ev.clientX + 15, ty = ev.clientY - 15;
                            if (tx + tw > window.innerWidth) tx = ev.clientX - tw - 15;
                            if (ty < 0) ty = ev.clientY + 15;
                            tooltip.style.left = `${tx}px`; tooltip.style.top = `${ty}px`;
                        };
                        moveFn(e);
                        dot.addEventListener('mousemove', moveFn);
                        dot.addEventListener('mouseleave', () => { tooltip.classList.remove('opacity-100'); dot.removeEventListener('mousemove', moveFn); }, {once:true});
                    });
                    matrixContainer.appendChild(dot);
                }
            });
        }

        function renderInsights(analysisData, targetList) {
             if (!analysisData || analysisData.data.length === 0) {
                 targetList.innerHTML = `<li class="text-gray-500">ë¯¸ë””ì–´ ì„±ê³¼ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”</li>`;
                 return;
            }
            const data = analysisData.data;
            targetList.innerHTML = '';
            
            const gradeInsights = { "Top ì†Œì¬": [], "Mid ì†Œì¬": [], "Low ì†Œì¬": [], "ROAS ì„±ê³¼": [] }; 
            let hasData = false;
            
            data.forEach(item => {
                const prefix = (item.media || item.placement || item.creativeName) ? `${item.media || 'N/A'}/${item.placement || 'N/A'}/${item.creativeName || 'N/A'}` : 'ë§¤ì²´ ìƒí’ˆê³¼ ì†Œì¬ëª… ì—†ìŒ';
                
                if (item.revenue > 0 && item.cost > 0) {
                    const roasData = getRoasInsight(item.roas, prefix);
                    if (roasData) {
                         gradeInsights["ROAS ì„±ê³¼"].push({ text: roasData.text, prefix: prefix });
                         hasData = true;
                    }
                }

                // [FIX] Changed logic: Do NOT use else-if. Check both independently.
                if (item.scoreC !== null && item.scoreB !== null) {
                    hasData = true;
                    let gradeKey = item.pmInsight.replace('ì†Œì¬', ' ì†Œì¬').replace('  ', ' ');
                    if(gradeKey === 'Lowì†Œì¬') gradeKey = 'Low ì†Œì¬';
                    if(gradeKey === 'Midì†Œì¬') gradeKey = 'Mid ì†Œì¬';
                    if(gradeKey === 'Topì†Œì¬') gradeKey = 'Top ì†Œì¬';

                    if (gradeInsights[gradeKey]) {
                        gradeInsights[gradeKey].push({ insight: item.mediaInsight, color: item.pmColor, type: '[PM]', prefix: prefix }); // Use pmColor
                    }
                } 
                
                if (item.scoreA !== null && item.scoreB !== null) {
                    hasData = true;
                    let gradeKey = item.daInsight.replace('ì†Œì¬', ' ì†Œì¬').replace('  ', ' ');
                    if(gradeKey === 'Lowì†Œì¬') gradeKey = 'Low ì†Œì¬';
                    if(gradeKey === 'Midì†Œì¬') gradeKey = 'Mid ì†Œì¬';
                    if(gradeKey === 'Topì†Œì¬') gradeKey = 'Top ì†Œì¬';
                    
                    if (gradeInsights[gradeKey]) {
                        gradeInsights[gradeKey].push({ insight: item.mediaInsight, color: item.daColor, type: '[DA]', prefix: prefix }); // Use daColor
                    }
                }
            });
            
            if (!hasData) {
                 targetList.innerHTML = `<li class="text-gray-500">ë¯¸ë””ì–´ ì„±ê³¼ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”</li>`;
                 return;
            }
            
            const renderGroup = (title, items, color) => {
                if (!items || items.length === 0) return;
                
                const header = document.createElement('li');
                header.className = `pt-4 mb-2 font-extrabold text-lg border-b-2 pb-1`;
                header.style.borderColor = color; header.style.color = color;
                header.innerHTML = `[${title}]`;
                targetList.appendChild(header);
                
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'text-gray-700 text-sm flex items-start mb-2';
                    
                    let iconColor = item.color || color;
                    let textContent = item.insight || item.text;
                    let prefixContent = item.prefix;
                    
                    if(title === 'ROAS ì„±ê³¼') {
                        const parts = item.text.split(/:(.+)/);
                        prefixContent = parts[0].trim();
                        textContent = parts[1] ? parts[1].trim() : item.text;
                    } else {
                         prefixContent = `${item.type} ${item.prefix}`;
                    }

                    li.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mt-1 mr-2 flex-shrink-0" style="color:${iconColor}" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                        <span>
                            <strong class="font-bold text-gray-900 block">${prefixContent}</strong>
                            <span class="block mt-1">${textContent}</span>
                        </span>
                    `;
                    targetList.appendChild(li);
                });
            };

            renderGroup("Top ì†Œì¬", gradeInsights["Top ì†Œì¬"], '#10b981'); 
            renderGroup("Mid ì†Œì¬", gradeInsights["Mid ì†Œì¬"], '#f59e0b'); 
            renderGroup("Low ì†Œì¬", gradeInsights["Low ì†Œì¬"], '#ef4444'); 
            renderGroup("ROAS ì„±ê³¼", gradeInsights["ROAS ì„±ê³¼"], '#ca8a04'); 
        }

        function renderTable(analysisData, tableBodyId) {
            const tableBody = document.getElementById(tableBodyId);
            const tableHeader = document.getElementById(tableBodyId.replace('body', 'header'));
            
            if (!analysisData || analysisData.data.length === 0) {
                 tableBody.innerHTML = `<tr><td colspan="19" class="text-center py-4 text-gray-500">ë¯¸ë””ì–´ ì„±ê³¼ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”</td></tr>`;
                 return;
            }
            
            const data = analysisData.data;
            tableBody.innerHTML = '';
            tableHeader.innerHTML = '';
            
            // [MODIFY] Reordered headers: A->B->C->Revenue->ROAS
            const headersToRender = [
                { name: 'ë§¤ì²´', key: 'media' }, { name: 'ìƒí’ˆ', key: 'placement' }, { name: 'ì†Œì¬ëª…', key: 'creativeName' },
                { name: 'ê´‘ê³ ë¹„(ì›)', key: 'cost' }, { name: 'ë…¸ì¶œìˆ˜', key: 'imp' }, { name: 'í´ë¦­ìˆ˜', key: 'click' }, { name: 'ì „í™˜ìˆ˜', key: 'conv' },
                { name: 'CPM(ì›)', key: 'actualCpm' }, { name: 'CTR(%)', key: 'actualCtr' }, { name: 'CPC(ì›)', key: 'actualCpc' }, 
                { name: 'CVR(%)', key: 'actualCvr' }, { name: 'CPA(ì›)', key: 'actualCpa' }, 
                { name: 'INSIGHT/í”¼ë“œë°±', key: 'insight_feedback_merged' },
                // Reordered scores
                { name: 'A ì ìˆ˜', key: 'scoreA' }, { name: 'B ì ìˆ˜', key: 'scoreB' }, { name: 'C ì ìˆ˜', key: 'scoreC' },
                { name: 'ë§¤ì¶œì•¡(ì›)', key: 'revenue' }, { name: 'ROAS(%)', key: 'roas' }
            ];
            
            headersToRender.forEach(header => {
                const th = document.createElement('th');
                th.className = 'px-4 py-3 text-center border-b border-gray-200 whitespace-nowrap bg-gray-100';
                
                // Toggle Logic
                if (['scoreA', 'scoreB', 'scoreC', 'revenue', 'roas'].includes(header.key)) {
                    th.classList.add('score-col');
                    if (!isScoreVisible) th.classList.add('hidden');
                }
                
                // [MODIFY] Button moved to INSIGHT/Feedback header
                if (header.key === 'insight_feedback_merged') {
                     th.innerHTML = `<div class="flex flex-col items-center justify-center relative">
                        <span>${header.name}</span>
                        <button class="toggle-score-btn mt-1 text-xs bg-indigo-500 text-white rounded px-2 py-0.5 hover:bg-indigo-700 transition-colors">${isScoreVisible ? 'ì ìˆ˜ ìˆ¨ê¹€' : 'ì ìˆ˜ ë³´ê¸°'}</button>
                     </div>`;
                    th.querySelector('.toggle-score-btn').addEventListener('click', (e) => {
                         e.stopPropagation(); toggleScoreColumns(); 
                    });
                } else if (header.key === 'cost') {
                     th.innerHTML = `${header.name} <span class="header-subtext">(ì†Œì§„ ê¸ˆì•¡)</span>`;
                } else if (header.key === 'scoreA') {
                     th.innerHTML = `${header.name} <span class="header-subtext">(ë…¸ì¶œ ì˜í–¥ë ¥)</span>`;
                } else if (header.key === 'scoreB') {
                     th.innerHTML = `${header.name} <span class="header-subtext">(ì†Œì¬ ê´€ì‹¬ë„)</span>`;
                } else if (header.key === 'scoreC') {
                     th.innerHTML = `${header.name} <span class="header-subtext">(ì „í™˜ ê¸°ì—¬ë„)</span>`;
                } else {
                    th.textContent = header.name;
                }
                tableHeader.appendChild(th);
            });
            
            data.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-indigo-50 transition-colors';
                
                headersToRender.forEach(header => {
                    const td = document.createElement('td');
                    td.className = 'px-4 py-3 whitespace-nowrap text-sm text-gray-600 text-center';
                    
                    if (['scoreA', 'scoreB', 'scoreC', 'revenue', 'roas'].includes(header.key)) {
                        td.classList.add('score-col');
                        if (!isScoreVisible) td.classList.add('hidden');
                    }

                    if (header.key === 'insight_feedback_merged') {
                        // DA Insight & Feedback
                        let html = `<div class="mb-1">
                            <span class="font-bold text-green-600">[DA] ${item.daInsight||'-'}</span>
                            <span class="block text-xs text-gray-500">${item.daAction||''}</span>
                        </div>`;
                        
                        // PM Insight & Feedback (if exists)
                        if (item.scoreC) {
                            html += `<div class="mt-2 pt-2 border-t border-gray-200">
                                <span class="font-bold text-indigo-600">[PM] ${item.pmInsight}</span>
                                <span class="block text-xs text-gray-500">${item.pmAction}</span>
                            </div>`;
                        }
                        td.innerHTML = html;
                        td.className = 'px-4 py-3 text-sm text-left min-w-[250px]'; 
                    } else {
                        let val = item[header.key];
                        if(['cost','revenue','actualCpm','actualCpc','actualCpa'].includes(header.key)) td.textContent = formatNumber(val, 'currency'); // [FIX] actual keys
                        else if(['imp','click','conv'].includes(header.key)) td.textContent = formatNumber(val, 'number');
                        else if(['actualCtr','actualCvr'].includes(header.key)) td.textContent = formatNumber(val, 'percent'); // [FIX] actual keys
                        else if(['roas'].includes(header.key)) td.textContent = `${Math.round(val).toLocaleString('ko-KR')}%`;
                        else if(['scoreA','scoreB','scoreC'].includes(header.key)) {
                            td.textContent = formatNumber(val, 'score');
                            td.classList.add('font-bold', 'text-gray-800');
                        } else {
                            td.textContent = val;
                        }
                    }
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });
        }
        
        function renderSampleInputTable(data) {
            const table = document.getElementById('sample-input-table');
            const config = validationTableConfigs['MAIN'];
            table.innerHTML = '';
            
            const thead = document.createElement('thead');
            thead.className = "bg-gray-100 sticky top-0 z-20"; 
            
            const trGroup = document.createElement('tr');
            trGroup.className = 'bg-gray-200 border-b-2 border-gray-300';
            config.headerGroups.forEach(group => {
                const th = document.createElement('th');
                th.className = 'px-2 py-2 text-xs font-bold text-gray-700 uppercase tracking-wider sticky top-0 bg-gray-200/100'; 
                th.colSpan = group.cols.length;
                th.textContent = group.name;
                trGroup.appendChild(th);
            });
            thead.appendChild(trGroup);
            
            const trDetail = document.createElement('tr');
            trDetail.className = 'bg-gray-100 border-b border-gray-200';
            config.cols.forEach(col => {
                const th = document.createElement('th');
                th.className = `px-2 py-2 text-xs font-semibold text-gray-700 uppercase tracking-wider sticky top-0 border-r border-gray-200 bg-gray-100 ${col.width || 'w-24'}`;
                if (col.key === 'cost') th.innerHTML = `${col.name} <span class="header-subtext">(ì†Œì§„ ê¸ˆì•¡)</span>`;
                else th.textContent = col.name;
                trDetail.appendChild(th);
            });
            thead.appendChild(trDetail);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            tbody.className = "bg-white divide-y divide-gray-200";
            
            data.forEach(row => {
                const tr = document.createElement('tr');
                // [FIX] Calculate missing metrics for sample data
                calculateValidationMetrics(row); 

                config.cols.forEach(col => {
                    const td = document.createElement('td');
                    td.className = 'p-2 text-xs whitespace-nowrap border-r border-gray-100 text-center';
                    
                    let val = row[col.key];

                    let innerContent = val;
                    if(col.type==='currency' && val!==null) innerContent = formatNumber(Math.round(val), 'currency');
                    else if(col.type==='percent' && val!==null) innerContent = formatNumber(val, 'percent');
                    else if(col.isLargeNumber && val!==null) innerContent = parseInt(val).toLocaleString('ko-KR');
                    
                    if (col.calculated) {
                        td.innerHTML = `<div class="w-full p-1 rounded-md text-xs bg-indigo-50 font-semibold text-indigo-700 text-center">${innerContent || '-'}</div>`;
                    } else {
                        td.textContent = innerContent || '-';
                    }
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
        }

        function showSampleModal() {
            const modal = document.getElementById('sample-modal');
            const modalContent = document.getElementById('sample-modal-body');
            modalContent.scrollTop = 0; 
            
            testProjectMockData.forEach(row => calculateValidationMetrics(row));

            renderSampleInputTable(testProjectMockData);
            
            const sampleAnalysis = aggregateAndScoreData(mapCampaignDataToValidation(testProjectMockData));
            sampleAnalysis.isSample = true;

            // 1. Summary
            const summarySec = document.getElementById('sample-summary-section');
            summarySec.innerHTML = '';
            const sumTable = document.createElement('div');
            sumTable.className = "mb-10";
            sumTable.innerHTML = `<h2 class="text-xl font-bold text-gray-800 mb-4">ì¢…í•© ì„±ê³¼ ìš”ì•½ (ìƒ˜í”Œ)</h2>
                <div class="scroll-container overflow-x-auto rounded-xl shadow-lg border">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-indigo-50"><tr id="sample-sum-head" class="text-sm font-semibold text-indigo-700 uppercase tracking-wider"></tr></thead>
                        <tbody class="bg-white"><tr id="sample-sum-body" class="text-gray-900"></tr></tbody>
                    </table>
                </div>`;
            summarySec.appendChild(sumTable);
            
            const hRow = sumTable.querySelector('#sample-sum-head');
            const bRow = sumTable.querySelector('#sample-sum-body');
            
             sampleAnalysis.summary.forEach(metric => {
                hRow.innerHTML += `<th class="px-6 py-3 text-center min-w-[150px]">${metric.label}</th>`;
                let mainVal = formatNumber(metric.value, metric.type);
                if (metric.key==='roas_avg') mainVal = `${Math.round(metric.value).toLocaleString('ko-KR')}%`;
                let subs = '';
                if (metric.subMetrics) {
                    metric.subMetrics.forEach(s => {
                        let sVal = formatNumber(s.value, s.type);
                         if (s.label === 'ì„±ê³¼ ROAS') sVal = `${Math.round(s.value).toLocaleString('ko-KR')}%`;
                        subs += `<div class="text-sm text-gray-600 mt-2"><span class="font-semibold">${s.label}:</span> ${sVal}</div>`;
                    });
                }
                bRow.innerHTML += `<td class="px-6 py-4 whitespace-nowrap text-center align-top"><div class="text-lg font-bold">${mainVal}</div>${subs}</td>`;
            });

            // 2. Chart
            const chartSec = document.getElementById('sample-chart-section');
            chartSec.innerHTML = `<div class="grid grid-cols-1 gap-10 mb-10">
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">ì†Œì¬ ì„±ê³¼ ë§¤íŠ¸ë¦¬ìŠ¤ (ìƒ˜í”Œ)</h2>
                    <div class="quadrant-matrix" id="sample-quadrant-matrix">
                         <div class="matrix-lines"><div class="v-line"></div><div class="h-line"></div></div>
                         <!-- Quadrants -->
                        <div class="quadrant quadrant-top-left"><div class="relative z-10 flex flex-col justify-center text-center"><h3 class="text-xl font-extrabold text-blue-700">High Potential</h3><p class="text-sm text-gray-500 mt-2">ë…¸ì¶œ íš¨ìœ¨(Low) ì†Œì¬ ë§¤ë ¥ë„(High)</p><p class="text-sm text-gray-700 mt-2">í›…í‚¹ì„±ì€ ë†’ì§€ë§Œ ì˜ ì•Œë ¤ì§€ì§€ ì•Šì€ ì†Œì¬</p><div class="mt-4"><span class="inline-block py-1 px-3 rounded-full text-sm font-semibold text-blue-800 bg-blue-100">Action : íƒ€ê²ŸíŒ… í™•ì¥</span></div></div></div>
                        <div class="quadrant quadrant-top-right"><div class="relative z-10 flex flex-col justify-center text-center"><h3 class="text-xl font-extrabold text-green-700">STAR</h3><p class="text-sm text-gray-500 mt-2">ë…¸ì¶œ íš¨ìœ¨(High) ì†Œì¬ ë§¤ë ¥ë„(High)</p><p class="text-sm text-gray-700 mt-2">ëŒ€ì¤‘ì ìœ¼ë¡œ ê°€ì¥ ë°˜ì‘ì´ ìš°ìˆ˜í•œ ì†Œì¬</p><div class="mt-4"><span class="inline-block py-1 px-3 rounded-full text-sm font-semibold text-green-800 bg-green-100">Action : ìœ ì§€ / ì˜ˆì‚° ì¦ëŒ€</span></div></div></div>
                        <div class="quadrant quadrant-bottom-left"><div class="relative z-10 flex flex-col justify-center text-center"><h3 class="text-xl font-extrabold text-red-700">Question Mark</h3><p class="text-sm text-gray-500 mt-2">ë…¸ì¶œ íš¨ìœ¨(Low) ì†Œì¬ ë§¤ë ¥ë„(Low)</p><p class="text-sm text-gray-700 mt-2">ì˜ˆì‚° ë‚­ë¹„ ê°€ëŠ¥ì„±ì´ ë†’ì€ ì†Œì¬</p><div class="mt-4"><span class="inline-block py-1 px-3 rounded-full text-sm font-semibold text-red-800 bg-red-100">Action : ê´‘ê³ OFF / ì˜ˆì‚°ì´ê´€</span></div></div></div>
                        <div class="quadrant quadrant-bottom-right"><div class="relative z-10 flex flex-col justify-center text-center"><h3 class="text-xl font-extrabold text-amber-700">Niche</h3><p class="text-sm text-gray-500 mt-2">ë…¸ì¶œ íš¨ìœ¨(High) ì†Œì¬ ë§¤ë ¥ë„(Low)</p><p class="text-sm text-gray-700 mt-2">ì†Œìˆ˜ì˜ ì§‘ë‹¨ì—ì„œ ë°˜ì‘ì´ ë†’ì€ ì†Œì¬</p><div class="mt-4"><span class="inline-block py-1 px-3 rounded-full text-sm font-semibold text-amber-800 bg-amber-100">Action : ë²”ìš©ì  ì†Œì¬ / í›…í‚¹ì„± ê°•í™”</span></div></div></div>
                    </div>
                </div></div>`;
            
            setTimeout(() => renderChart(sampleAnalysis), 0);

            // 3. Insight (ìš”ì²­: ë§¤íŠ¸ë¦¬ìŠ¤ í•˜ë‹¨ìœ¼ë¡œ ì´ë™)
            renderInsights(sampleAnalysis, document.getElementById('sample-insight-list'));

            // 4. Detail Table (ìš”ì²­: ë°ì´í„° ëˆ„ë½ ìˆ˜ì • - HTML íƒœê·¸ ìˆ˜ì • ì™„ë£Œ)
            renderTable(sampleAnalysis, 'sample-table-body');

            modal.classList.remove('hidden');
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            const tooltip = document.createElement('div');
            tooltip.id = 'chart-tooltip';
            tooltip.className = 'fixed p-2 bg-gray-800 text-white text-xs rounded-lg shadow-xl pointer-events-none opacity-0 transition-opacity duration-200 z-[100] whitespace-nowrap';
            document.body.appendChild(tooltip);

            if(localStorage.getItem(DASHBOARD_STORAGE_KEY)) {
                storageData = JSON.parse(localStorage.getItem(DASHBOARD_STORAGE_KEY));
                currentProject = storageData.currentProject;
            }
            if(!storageData.projects['default']) storageData.projects['default'] = defaultValidationData;
            
            validationData = storageData.projects[currentProject];
            if(!validationData || !validationData.MAIN) {
                 validationData = { 'MAIN': mapCampaignDataToValidation([{}]) };
                 storageData.projects[currentProject] = validationData;
            }
            
            // Initial Toggle State Ensure
            isPerfInputVisible = false;
            isScoreVisible = false; // [NEW]

            updateProjectSelector();
            
            viewSampleButton.addEventListener('click', showSampleModal);
            document.getElementById('close-sample-modal').addEventListener('click', () => document.getElementById('sample-modal').classList.add('hidden'));
            document.getElementById('close-sample-modal-btn').addEventListener('click', () => document.getElementById('sample-modal').classList.add('hidden'));
            
            newProjectButton.addEventListener('click', () => {
                const name = prompt("ìƒˆ í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:");
                if(name) {
                    storageData.projects[name] = { MAIN: mapCampaignDataToValidation([{}]) };
                    currentProject = name; storageData.currentProject = name;
                    validationData = storageData.projects[name];
                    updateProjectSelector(); saveDataToLocalStorage(); renderDashboard();
                }
            });
            
            editProjectButton.addEventListener('click', () => {
                if(currentProject === 'default') return alert("ê¸°ë³¸ í”„ë¡œì íŠ¸ ì´ë¦„ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                const newName = prompt("í”„ë¡œì íŠ¸ ì´ë¦„ì„ ìˆ˜ì •í•˜ì„¸ìš”:", currentProject);
                if(newName && newName !== currentProject) {
                    if (storageData.projects[newName]) return alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í”„ë¡œì íŠ¸ ì´ë¦„ì…ë‹ˆë‹¤.");
                    storageData.projects[newName] = storageData.projects[currentProject];
                    delete storageData.projects[currentProject];
                    currentProject = newName; storageData.currentProject = newName;
                    updateProjectSelector(); saveDataToLocalStorage();
                }
            });
            
             deleteProjectButton.addEventListener('click', () => {
                if(currentProject === 'default') return alert("ê¸°ë³¸ í”„ë¡œì íŠ¸ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    delete storageData.projects[currentProject];
                    currentProject = 'default'; storageData.currentProject = 'default';
                    validationData = storageData.projects['default'];
                    updateProjectSelector(); saveDataToLocalStorage(); renderDashboard();
                }
            });
            
            projectSelector.addEventListener('change', (e) => {
                currentProject = e.target.value;
                storageData.currentProject = currentProject;
                validationData = storageData.projects[currentProject];
                updateProjectSelector();
                renderDashboard();
            });

            toggleValidationTableButton.addEventListener('click', toggleValidationTable);
            addValidationRowButton.addEventListener('click', addValidationRow);
            runAnalysisButton.addEventListener('click', () => { liveAnalysisData = aggregateAndScoreData(); renderSummaryTable(); renderChart(liveAnalysisData); renderInsights(liveAnalysisData, document.getElementById('insight-list')); renderTable(liveAnalysisData, 'table-body'); });
            
            saveDataButton.addEventListener('click', saveDataToLocalStorage);
            resetDataButton.addEventListener('click', () => {
                if(confirm("ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    validationData['MAIN'] = mapCampaignDataToValidation([{}]);
                    isPrefillActive = false;
                    renderDashboard();
                }
            });

            renderDashboard();
            window.addEventListener('resize', () => renderChart(liveAnalysisData));
        });

        function renderDashboard() {
            // Recalculate metrics
            validationData['MAIN'].forEach(r => calculateValidationMetrics(r));
            renderValidationTable();
            liveAnalysisData = aggregateAndScoreData();
            renderSummaryTable();
            renderChart(liveAnalysisData);
            renderInsights(liveAnalysisData, document.getElementById('insight-list'));
            renderTable(liveAnalysisData, 'table-body');
        }
    </script>
</body>
</html>
